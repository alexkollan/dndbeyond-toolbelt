var DNDBeyondToolbelt;(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},s=[],r=0;r<e.length;r++){var l=e[r],c=a.base?l[0]+a.base:l[0],d=o[c]||0,p="".concat(c," ").concat(d);o[c]=d+1;var u=n(p),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var h=i(m,a);a.byIndex=r,t.splice(r,0,{identifier:p,updater:h,references:1})}s.push(p)}return s}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=a(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var r=n(o[s]);t[r].references--}for(var l=a(e,i),c=0;c<o.length;c++){var d=n(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,a,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&s[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},365:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(601),i=n.n(a),o=n(314),s=n.n(o)()(i());s.push([e.id,"/* D&D Beyond Toolbelt Styles */\n\n/* Toolbelt Button Integration */\n.ct-character-header-desktop__group--toolbelt {\n  margin-right: 12px;\n}\n\n.toolbelt-button {\n  display: flex;\n  align-items: center;\n  transition: all 0.2s ease;\n  cursor: pointer;\n}\n\n.toolbelt-button:hover {\n  opacity: 0.8;\n}\n\n.toolbelt-button:active {\n  transform: translateY(1px);\n}\n\n/* Fix SVG alignment and sizing */\n.toolbelt-button .ct-character-header-desktop__button-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  margin-right: 8px;\n}\n\n.toolbelt-button .ct-character-header-desktop__button-icon svg {\n  width: 16px;\n  height: 16px;\n  display: block;\n}\n\n/* Ensure the button matches D&D Beyond's styling exactly */\n.toolbelt-button .ct-character-header-desktop__button-label {\n  color: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  font-family: inherit;\n  line-height: 1;\n}\n\n/* Control Panel Styles */\n.toolbelt-control-panel {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 10000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.control-panel-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(2px);\n}\n\n.control-panel-content {\n  position: relative;\n  background: #1e1e1e;\n  border: 2px solid #53a5c5;\n  border-radius: 12px;\n  min-width: 400px;\n  max-width: 500px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  color: #ffffff;\n  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n}\n\n.control-panel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px;\n  border-bottom: 1px solid #333;\n}\n\n.control-panel-header h3 {\n  margin: 0;\n  color: #53a5c5;\n  font-size: 1.25rem;\n  font-weight: 600;\n}\n\n.control-panel-close {\n  background: none;\n  border: none;\n  color: #ffffff;\n  font-size: 24px;\n  cursor: pointer;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  transition: background-color 0.2s ease;\n}\n\n.control-panel-close:hover {\n  background-color: #333;\n}\n\n.control-panel-body {\n  padding: 20px 24px;\n}\n\n.control-panel-description {\n  margin: 0 0 20px 0;\n  color: #cccccc;\n  font-size: 0.9rem;\n  line-height: 1.4;\n}\n\n.features-list {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.feature-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 16px;\n  background: #2a2a2a;\n  border-radius: 8px;\n  border: 1px solid #333;\n  transition: border-color 0.2s ease;\n}\n\n.feature-item:hover {\n  border-color: #53a5c5;\n}\n\n.feature-toggle {\n  display: flex;\n  align-items: flex-start;\n  cursor: pointer;\n  flex: 1;\n}\n\n.feature-toggle input[type=\"checkbox\"] {\n  display: none;\n}\n\n.toggle-slider {\n  position: relative;\n  width: 44px;\n  height: 24px;\n  background: #444;\n  border-radius: 12px;\n  margin-right: 12px;\n  margin-top: 2px;\n  flex-shrink: 0;\n  transition: background-color 0.3s ease;\n}\n\n.toggle-slider::before {\n  content: '';\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  background: #ffffff;\n  border-radius: 50%;\n  top: 2px;\n  left: 2px;\n  transition: transform 0.3s ease;\n}\n\n.feature-toggle input[type=\"checkbox\"]:checked + .toggle-slider {\n  background: #53a5c5;\n}\n\n.feature-toggle input[type=\"checkbox\"]:checked + .toggle-slider::before {\n  transform: translateX(20px);\n}\n\n.feature-info {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n}\n\n.feature-label {\n  color: #ffffff;\n  font-size: 0.95rem;\n  font-weight: 500;\n  margin-bottom: 2px;\n}\n\n.feature-description {\n  color: #cccccc;\n  font-size: 0.8rem;\n  line-height: 1.3;\n}\n\n.feature-status {\n  margin-left: 12px;\n}\n\n.status-indicator {\n  padding: 4px 8px;\n  border-radius: 4px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.status-indicator.enabled {\n  background: rgba(76, 175, 80, 0.2);\n  color: #4caf50;\n  border: 1px solid #4caf50;\n}\n\n.status-indicator.disabled {\n  background: rgba(244, 67, 54, 0.2);\n  color: #f44336;\n  border: 1px solid #f44336;\n}\n\n.control-panel-footer {\n  padding: 16px 24px;\n  border-top: 1px solid #333;\n  text-align: center;\n}\n\n.control-panel-footer small {\n  color: #888;\n  font-size: 0.8rem;\n}\n\n/* Responsive Design */\n@media (max-width: 480px) {\n  .control-panel-content {\n    min-width: 320px;\n    margin: 20px;\n  }\n  \n  .control-panel-header,\n  .control-panel-body,\n  .control-panel-footer {\n    padding-left: 16px;\n    padding-right: 16px;\n  }\n}\n",""]);const r=s},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,i&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={id:a,exports:{}};return e[a](o,o.exports,n),o.exports}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,o(a.key),a)}}function o(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;const s=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onClick=t,this.element=null},t=[{key:"render",value:function(){var e=this;return this.element||(this.element=document.createElement("div"),this.element.className="ct-character-header-desktop__button toolbelt-button",this.element.setAttribute("role","button"),this.element.setAttribute("tabindex","0"),this.element.innerHTML='\n      <div class="ct-character-header-desktop__button-icon">\n        <svg \n          xmlns="http://www.w3.org/2000/svg" \n          viewBox="0 0 50 50" \n          class="ddbc-svg ddbc-toolbelt-svg ddbc-svg--themed"\n        >\n          <path \n            fill="#53a5c5" \n            d="M25 5c-11 0-20 9-20 20s9 20 20 20 20-9 20-20S36 5 25 5zm0 36c-8.8 0-16-7.2-16-16S16.2 9 25 9s16 7.2 16 16-7.2 16-16 16z"\n          />\n          <path \n            fill="#53a5c5" \n            d="M32 18h-5v-5c0-1.1-.9-2-2-2s-2 .9-2 2v5h-5c-1.1 0-2 .9-2 2s.9 2 2 2h5v5c0 1.1.9 2 2 2s2-.9 2-2v-5h5c1.1 0 2-.9 2-2s-.9-2-2-2z"\n          />\n        </svg>\n      </div>\n      <span class="ct-character-header-desktop__button-label">Toolbelt</span>\n    ',this.element.addEventListener("click",this.onClick),this.element.addEventListener("keydown",function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.onClick())})),this.element}}],t&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d(a.key),a)}}function d(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}const p=function(){return e=function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.features=t,this.onToggleFeature=n,this.onClose=a,this.element=null},t=[{key:"render",value:function(){return this.element||(this.element=document.createElement("div"),this.element.className="toolbelt-control-panel",this.element.innerHTML='\n      <div class="control-panel-overlay"></div>\n      <div class="control-panel-content">\n        <div class="control-panel-header">\n          <h3>D&D Beyond Toolbelt</h3>\n          <button class="control-panel-close">×</button>\n        </div>\n        <div class="control-panel-body">\n          <p class="control-panel-description">\n            Toggle features to enhance your D&D Beyond experience\n          </p>\n          <div class="features-list">\n            '.concat(this.renderFeatures(),'\n          </div>\n        </div>\n        <div class="control-panel-footer">\n          <small>Version 1.0.0 - D&D Beyond Toolbelt</small>\n        </div>\n      </div>\n    '),this.attachEventListeners()),this.element}},{key:"renderFeatures",value:function(){return Object.entries(this.features).map(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,o,s,r=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=o.call(n)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],a=t[1];return'\n      <div class="feature-item">\n        <label class="feature-toggle">\n          <input\n            type="checkbox"\n            data-feature="'.concat(n,'"\n            ').concat(a.enabled?"checked":"",'\n          />\n          <span class="toggle-slider"></span>\n          <span class="feature-info">\n            <span class="feature-label">').concat(a.label,'</span>\n            <span class="feature-description">').concat(a.description,'</span>\n          </span>\n        </label>\n        <div class="feature-status">\n          <span class="status-indicator ').concat(a.enabled?"enabled":"disabled",'">\n            ').concat(a.enabled?"ON":"OFF","\n          </span>\n        </div>\n      </div>\n    ")}).join("")}},{key:"attachEventListeners",value:function(){var e=this;this.element.querySelector(".control-panel-close").addEventListener("click",this.onClose),this.element.querySelector(".control-panel-overlay").addEventListener("click",this.onClose),this.element.querySelectorAll('input[type="checkbox"]').forEach(function(t){t.addEventListener("change",function(t){var n=t.target.dataset.feature;e.onToggleFeature(n)})});var t=function(n){"Escape"===n.key&&(e.onClose(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}},{key:"updateFeatures",value:function(e){var t=this;this.features=e,this.element.querySelector(".features-list").innerHTML=this.renderFeatures(),this.element.querySelectorAll('input[type="checkbox"]').forEach(function(e){e.addEventListener("change",function(e){var n=e.target.dataset.feature;t.onToggleFeature(n)})})}}],t&&c(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,h(a.key),a)}}function h(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}const f=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="Spell Enhancements",this.description="Hide upcasted spells and show only base level versions",this.initialized=!1,this.hideUpcastedSpells=!1,this.hiddenSpells=new Set},(t=[{key:"init",value:function(){this.initialized||(console.log("🔮 Spell Enhancements feature initialized"),this.initialized=!0)}},{key:"addToggleButton",value:function(){var e=this,t=document.querySelector(".ct-spells-filter");if(t){var n=document.createElement("button");n.className="ct-theme-button ct-theme-button--outline ct-theme-button--interactive ct-button character-button ddbc-button character-button-medium spell-enhancement-toggle",n.innerHTML='\n      <span class="ct-button__content">\n        <span class="spell-enhancement-icon">🔮</span>\n        Hide Upcasted Spells\n      </span>\n    ',n.style.marginLeft="10px",n.style.opacity=this.hideUpcastedSpells?"1":"0.7",n.addEventListener("click",function(){e.toggleUpcastedSpells()});var a=t.querySelector(".ct-spells-filter__callout button");a&&a.parentNode&&a.parentNode.appendChild(n)}}},{key:"toggleUpcastedSpells",value:function(){this.hideUpcastedSpells=!this.hideUpcastedSpells;var e=document.querySelector(".spell-enhancement-toggle");if(e){e.style.opacity=this.hideUpcastedSpells?"1":"0.7";var t=e.querySelector(".ct-button__content");t&&(t.innerHTML='\n          <span class="spell-enhancement-icon">🔮</span>\n          '.concat(this.hideUpcastedSpells?"Show All Spells":"Hide Upcasted Spells","\n        "))}this.hideUpcastedSpells?this.hideUpcastedSpellsFromDOM():this.showAllSpells(),console.log("🔮 Upcasted spells ".concat(this.hideUpcastedSpells?"hidden":"shown"))}},{key:"hideUpcastedSpellsFromDOM",value:function(){var e=this;this.showAllSpells(),this.hiddenSpells.clear(),document.querySelectorAll(".ct-spells-spell").forEach(function(t){t.querySelector(".ct-spells-spell__scaled")&&(t.style.display="none",e.hiddenSpells.add(t),e.checkAndHideEmptySpellLevel(t))}),console.log("🔮 Hidden ".concat(this.hiddenSpells.size," upcasted spells"))}},{key:"checkAndHideEmptySpellLevel",value:function(e){var t=e.closest(".ct-spells-level__spells-content");if(t){var n=t.querySelectorAll(".ct-spells-spell");if(0===Array.from(n).filter(function(e){return"none"!==e.style.display}).length){var a=t.closest(".ct-content-group");a&&(a.style.display="none",this.hiddenSpells.add(a))}}}},{key:"showAllSpells",value:function(){this.hiddenSpells.forEach(function(e){e.style.display=""}),this.hiddenSpells.clear()}},{key:"onTabChange",value:function(e,t){"Spells"===e&&t&&(console.log("🔮 Spell Enhancements: Spells tab is now active!"),this.handleSpellsTab())}},{key:"handleSpellsTab",value:function(){var e=this;setTimeout(function(){document.querySelector(".spell-enhancement-toggle")||e.addToggleButton(),e.hideUpcastedSpells&&e.hideUpcastedSpellsFromDOM()},500)}}])&&m(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),g={cantrip:[],"1st":[{name:"Find Familiar",url:"https://www.dndbeyond.com/spells/find-familiar",casting_time:"1 hour",range:"10 feet",attack:"--",damage:"Utility",components:{verbal:!0,somatic:!0,material:!0,duration:"Instantaneous"},source:"Player's Handbook"}],"2nd":[{name:"Web",url:"https://www.dndbeyond.com/spells/web",casting_time:"1 action",range:"60 feet",attack:"dex save",damage:"Control",components:{verbal:!0,somatic:!0,material:!0,duration:"Concentration, up to 1 hour"},source:"Player's Handbook"}],"3rd":[{name:"Counterspell",url:"https://www.dndbeyond.com/spells/counterspell",casting_time:"1 reaction",range:"60 feet",attack:"--",damage:"Control",components:{verbal:!1,somatic:!0,material:!1,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Leomund's Tiny Hut",url:"https://www.dndbeyond.com/spells/leomunds-tiny-hut",casting_time:"1 minute",range:"10 feet",attack:"--",damage:"Utility",components:{verbal:!0,somatic:!0,material:!0,duration:"8 hours"},source:"Player's Handbook"}],"4th":[{name:"Banishment",url:"https://www.dndbeyond.com/spells/banishment",casting_time:"1 action",range:"60 feet",attack:"cha save",damage:"Banishment",components:{verbal:!0,somatic:!0,material:!0,duration:"Concentration, up to 1 minute"},source:"Player's Handbook"},{name:"Dimension Door",url:"https://www.dndbeyond.com/spells/dimension-door",casting_time:"1 action",range:"500 feet",attack:"--",damage:"Teleportation",components:{verbal:!0,somatic:!1,material:!1,duration:"Instantaneous"},source:"Player's Handbook"}],"5th":[{name:"Wall of Force",url:"https://www.dndbeyond.com/spells/wall-of-force",casting_time:"1 action",range:"120 feet",attack:"--",damage:"Control",components:{verbal:!0,somatic:!0,material:!0,duration:"Concentration, up to 10 minutes"},source:"Player's Handbook"},{name:"Mass Cure Wounds",url:"https://www.dndbeyond.com/spells/mass-cure-wounds",casting_time:"1 action",range:"60 feet",attack:"--",damage:"Healing",components:{verbal:!0,somatic:!0,material:!1,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Animate Objects",url:"https://www.dndbeyond.com/spells/animate-objects",casting_time:"1 action",range:"120 feet",attack:"--",damage:"Control",components:{verbal:!0,somatic:!0,material:!1,duration:"Concentration, up to 1 minute"},source:"Player's Handbook"},{name:"Bigby's Hand",url:"https://www.dndbeyond.com/spells/bigbys-hand",casting_time:"1 action",range:"120 feet",attack:"--",damage:"Control",components:{verbal:!0,somatic:!0,material:!0,duration:"Concentration, up to 1 minute"},source:"Player's Handbook"}],"6th":[{name:"Heal",url:"https://www.dndbeyond.com/spells/heal",casting_time:"1 action",range:"Touch",attack:"--",damage:"Healing",components:{verbal:!0,somatic:!0,material:!1,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Disintegrate",url:"https://www.dndbeyond.com/spells/disintegrate",casting_time:"1 action",range:"60 feet",attack:"dex save",damage:"10d6+40 force",components:{verbal:!0,somatic:!0,material:!0,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Otto's Irresistible Dance",url:"https://www.dndbeyond.com/spells/ottos-irresistible-dance",casting_time:"1 action",range:"30 feet",attack:"wis save",damage:"Control",components:{verbal:!0,somatic:!1,material:!1,duration:"Concentration, up to 1 minute"},source:"Player's Handbook"}],"7th":[{name:"Plane Shift",url:"https://www.dndbeyond.com/spells/plane-shift",casting_time:"1 action",range:"Touch",attack:"cha save",damage:"Banishment",components:{verbal:!0,somatic:!0,material:!0,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Mordenkainen's Magnificent Mansion",url:"https://www.dndbeyond.com/spells/mordenkainens-magnificent-mansion",casting_time:"1 minute",range:"300 feet",attack:"--",damage:"Utility",components:{verbal:!0,somatic:!0,material:!0,duration:"24 hours"},source:"Player's Handbook"},{name:"Simulacrum",url:"https://www.dndbeyond.com/spells/simulacrum",casting_time:"12 hours",range:"Touch",attack:"--",damage:"Creation",components:{verbal:!0,somatic:!0,material:!0,duration:"Until dispelled"},source:"Player's Handbook"},{name:"Forcecage",url:"https://www.dndbeyond.com/spells/forcecage",casting_time:"1 action",range:"100 feet",attack:"cha save",damage:"Control",components:{verbal:!0,somatic:!0,material:!0,duration:"1 hour"},source:"Player's Handbook"},{name:"Mirage Arcane",url:"https://www.dndbeyond.com/spells/mirage-arcane",casting_time:"10 minutes",range:"Sight",attack:"--",damage:"Illusion",components:{verbal:!0,somatic:!0,material:!1,duration:"10 days"},source:"Player's Handbook"}],"8th":[{name:"Clone",url:"https://www.dndbeyond.com/spells/clone",casting_time:"1 hour",range:"Touch",attack:"--",damage:"Creation",components:{verbal:!0,somatic:!0,material:!0,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Maze",url:"https://www.dndbeyond.com/spells/maze",casting_time:"1 action",range:"60 feet",attack:"--",damage:"Banishment",components:{verbal:!0,somatic:!0,material:!1,duration:"Concentration, up to 10 minutes"},source:"Player's Handbook"},{name:"Control Weather",url:"https://www.dndbeyond.com/spells/control-weather",casting_time:"10 minutes",range:"Self (5-mile radius)",attack:"--",damage:"Control",components:{verbal:!0,somatic:!0,material:!0,duration:"Concentration, up to 8 hours"},source:"Player's Handbook"},{name:"Glibness",url:"https://www.dndbeyond.com/spells/glibness",casting_time:"1 action",range:"Self",attack:"--",damage:"Enhancement",components:{verbal:!0,somatic:!1,material:!1,duration:"1 hour"},source:"Player's Handbook"},{name:"Feeblemind",url:"https://www.dndbeyond.com/spells/feeblemind",casting_time:"1 action",range:"150 feet",attack:"int save",damage:"Debuff",components:{verbal:!0,somatic:!0,material:!0,duration:"Instantaneous"},source:"Player's Handbook"},{name:"Mind Blank",url:"https://www.dndbeyond.com/spells/mind-blank",casting_time:"1 action",range:"Touch",attack:"--",damage:"Protection",components:{verbal:!0,somatic:!0,material:!1,duration:"24 hours"},source:"Player's Handbook"}],"9th":[]};function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,o,s,r=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=o.call(n)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return r}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return x(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function k(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,w(a.key),a)}}function w(e){var t=function(e){if("object"!=v(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==v(t)?t:t+""}const S=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="Add Extra Spells",this.description="Adds custom spells to the spells tab with dark purple cast buttons",this.initialized=!1,this.extraSpells=g,this.addedSpells=new Set},t=[{key:"init",value:function(){var e=this;this.initialized||(this.loadExtraSpells(),window.dndbToolbelt=window.dndbToolbelt||{},window.dndbToolbelt.addExtraSpells=function(){e.handleSpellsTab()},this.initialized=!0)}},{key:"disable",value:function(){this.removeExtraSpells(),this.addedSpells.clear()}},{key:"loadExtraSpells",value:function(){}},{key:"onTabChange",value:function(e,t){"Spells"===e&&t&&this.handleSpellsTab()}},{key:"handleSpellsTab",value:function(){var e=this;setTimeout(function(){e.addCustomStyles(),e.addExtraSpellsToDOM()},500)}},{key:"addExtraSpellsToDOM",value:function(){var e=this;this.extraSpells&&0!==Object.keys(this.extraSpells).length&&(this.addedSpells.clear(),Object.entries(this.extraSpells).forEach(function(t){var n=b(t,2),a=n[0],i=n[1];e.addSpellsToLevel(a,i)}))}},{key:"addSpellsToLevel",value:function(e,t){var n=this,a=this.findSpellLevelContainer(e);if(a){var i=a.querySelector(".ct-spells-level__spells-content");i&&t.forEach(function(t){var a="".concat(e,"-").concat(t.name.replace(/\s+/g,"-").toLowerCase());if(i.querySelector('[data-spell-id="'.concat(a,'"]')))n.addedSpells.add(a);else{var o=n.createSpellElement(t,a);i.appendChild(o),n.addedSpells.add(a)}})}}},{key:"findSpellLevelContainer",value:function(e){var t={cantrip:"Cantrip","1st":"1st Level","2nd":"2nd Level","3rd":"3rd Level","4th":"4th Level","5th":"5th Level","6th":"6th Level","7th":"7th Level","8th":"8th Level","9th":"9th Level"}[e];if(!t)return null;var n,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=y(e))){t&&(e=t);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw i}}}}(document.querySelectorAll(".ct-content-group__header-content"));try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.textContent.trim()===t){var o=i.closest(".ct-content-group");if(o)return o}}}catch(e){a.e(e)}finally{a.f()}return null}},{key:"createSpellElement",value:function(e,t){var n=document.createElement("div");return n.className="ct-spells-spell",n.setAttribute("data-spell-id",t),n.innerHTML='\n      <div class="ct-spells-spell__action">\n        <button class="ct-theme-button ct-theme-button--filled ct-theme-button--interactive ct-button character-button ddbc-button character-button-block-small dndb-toolbelt-extra-spell" role="button">\n          <span class="ct-button__content">Cast</span>\n        </button>\n      </div>\n      <div class="ct-spells-spell__name">\n        <div class="ct-spells-spell__label">\n          '.concat(e.url?'<a href="'.concat(e.url,'" target="_blank" rel="noopener noreferrer" class="styles_spellName__wX3ll" style="text-decoration: none; color: inherit;">').concat(e.name,"</a>"):'<span class="styles_spellName__wX3ll">'.concat(e.name,"</span>"),'\n        </div>\n        <div class="ct-spells-spell__meta ct-spells-spell__meta--dark-mode">\n          <span class="ct-spells-spell__meta-item">Custom</span>\n          <span class="ct-spells-spell__meta-item">').concat(e.source||"Homebrew",'</span>\n        </div>\n      </div>\n      <div class="ct-spells-spell__activation ct-spells-spell__activation--dark-mode">\n        <span class="ddbc-tooltip ddbc-tooltip--dark-mode" data-tippy="" data-original-title="').concat(e.casting_time,'">').concat(this.formatCastingTime(e.casting_time),'</span>\n      </div>\n      <div class="ct-spells-spell__range ct-spells-spell--dark-mode">\n        <span class="ct-spells-spell__range-value">').concat(this.formatRange(e.range),'</span>\n      </div>\n      <div class="ct-spells-spell__attacking">\n        ').concat(this.formatAttack(e.attack),'\n      </div>\n      <div class="ct-spells-spell__damage">\n        ').concat(this.formatDamage(e.damage),'\n      </div>\n      <div class="ct-spells-spell__notes">\n        ').concat(this.formatComponents(e.components),"\n      </div>\n    "),n}},{key:"formatCastingTime",value:function(e){return{"1 action":"1A","1 bonus action":"1BA","1 reaction":"1R","1 minute":"1m","10 minutes":"10m","1 hour":"1h","8 hours":"8h","24 hours":"24h"}[e]||e}},{key:"formatRange",value:function(e){if("Self"===e||"Touch"===e)return'<span class="ct-spells-spell__range-origin">'.concat(e,"</span>");var t=e.match(/(\d+)\s*(feet|ft)/i);return t?'<span class="styles_numberDisplay__Rg1za"><span>'.concat(t[1],'</span><span class="styles_label__L8mZK styles_labelSignColor__Klmbs">ft.</span></span>'):'<span class="ct-spells-spell__range-value">'.concat(e,"</span>")}},{key:"formatAttack",value:function(e){if(!e||"--"===e)return'<div class="ct-spells-spell__empty-value">--</div>';if(e.includes("save")){var t=e.match(/(\w+)\s+(\d+)/i);if(t){var n=b(t,3),a=n[1],i=n[2];return'\n          <div class="ct-spells-spell__save">\n            <span class="ct-spells-spell__save-label ct-spells-spell--dark-mode">'.concat(a.toLowerCase(),'</span>\n            <span class="ct-spells-spell__save-value ct-spells-spell--dark-mode">').concat(i,"</span>\n          </div>\n        ")}}if(e.includes("+")){var o=e.replace("+","");return'\n        <div class="ct-spells-spell__tohit">\n          <button aria-haspopup="menu" class="integrated-dice__container">\n            <span class="styles_numberDisplay__Rg1za styles_signed__scf97">\n              <span class="styles_sign__NdR6X styles_labelSignColor__Klmbs" aria-label="plus">+</span>\n              <span>'.concat(o,"</span>\n            </span>\n          </button>\n        </div>\n      ")}return'<div class="ct-spells-spell__empty-value">--</div>'}},{key:"formatDamage",value:function(e){if(!e||"--"===e)return'\n        <div class="ddbc-spell-damage-effect ddbc-spell-damage-effect--dark-mode">\n          <span class="ddbc-spell-damage-effect__tags ddbc-spell-damage-effect__tags--dark-mode">Varies</span>\n        </div>\n      ';var t=e.match(/(\d+d\d+(?:\+\d+)?)\s*(\w+)?/i);if(t){var n=b(t,3),a=n[1],i=n[2],o=this.getDamageTypeIcon(i);return'\n        <div class="ddbc-spell-damage-effect ddbc-spell-damage-effect--dark-mode">\n          <span class="ddbc-spell-damage-effect__damages">\n            <button aria-haspopup="menu" class="integrated-dice__container">\n              <span class="ddbc-damage__value ddbc-damage__value--dark-mode">'.concat(a,"</span>\n              ").concat(o,"\n            </button>\n          </span>\n        </div>\n      ")}return'\n      <div class="ddbc-spell-damage-effect ddbc-spell-damage-effect--dark-mode">\n        <span class="ddbc-spell-damage-effect__tags ddbc-spell-damage-effect__tags--dark-mode">'.concat(e,"</span>\n      </div>\n    ")}},{key:"getDamageTypeIcon",value:function(e){if(!e)return"";var t={fire:"fire",cold:"cold",lightning:"lightning",thunder:"thunder",acid:"acid",poison:"poison",necrotic:"necrotic",radiant:"radiant",psychic:"psychic",force:"force",piercing:"piercing",slashing:"slashing",bludgeoning:"bludgeoning"}[e.toLowerCase()];return t?'\n        <span class="ddbc-damage__icon">\n          <span class="ddbc-damage-type-icon ddbc-damage-type-icon--'.concat(t,'" aria-label="').concat(e,' damage">\n            <span class="ddbc-tooltip ddbc-tooltip--dark-mode" data-tippy="" data-original-title="').concat(e,'">\n              \x3c!-- SVG icon would go here --\x3e\n            </span>\n          </span>\n        </span>\n      '):""}},{key:"formatComponents",value:function(e){var t=this;if(!e)return'<div class="ddbc-note-components"></div>';var n=[];if(e.duration){var a={Instantaneous:"Instant","1 minute":"D: 1m","10 minutes":"D: 10m","1 hour":"D: 1h","8 hours":"D: 8h","24 hours":"D: 24h","Until dispelled":"D: Until dispelled","Concentration, up to 1 minute":"D: 1m","Concentration, up to 10 minutes":"D: 10m","Concentration, up to 1 hour":"D: 1h"}[e.duration]||e.duration;n.push('<span class="ddbc-tooltip ddbc-note-components__component ddbc-note-components__component--tooltip ddbc-note-components__component--dark-mode ddbc-tooltip--dark-mode" data-tippy="" data-original-title="'.concat(e.duration,'">').concat(a,"</span>"))}var i=[];if(e.verbal&&i.push("V"),e.somatic&&i.push("S"),e.material&&i.push("M"),i.length>0){var o=i.map(function(e){return'<span class="ddbc-tooltip ddbc-note-components__component ddbc-note-components__component--tooltip ddbc-note-components__component--dark-mode ddbc-tooltip--dark-mode" data-tippy="" data-original-title="'.concat(t.getComponentTooltip(e),'">').concat(e,"</span>")}).join("/");n.push(o)}return'<div class="ddbc-note-components">'.concat(n.join(", "),"</div>")}},{key:"getComponentTooltip",value:function(e){return{V:"Verbal",S:"Somatic",M:"Material"}[e]||e}},{key:"addCustomStyles",value:function(){if(!document.getElementById("dndb-toolbelt-extra-spells-styles")){var e=document.createElement("style");e.id="dndb-toolbelt-extra-spells-styles",e.textContent="\n      .dndb-toolbelt-extra-spell {\n        background-color: #4a148c !important;\n        border-color: #4a148c !important;\n      }\n      \n      .dndb-toolbelt-extra-spell:hover {\n        background-color: #6a1b9a !important;\n        border-color: #6a1b9a !important;\n      }\n      \n      .dndb-toolbelt-extra-spell:active {\n        background-color: #38006b !important;\n        border-color: #38006b !important;\n      }\n\n      .dndb-toolbelt-extra-spell .ct-button__content {\n        color: white !important;\n      }\n\n      /* Styling for clickable spell names */\n      [data-spell-id] .styles_spellName__wX3ll a {\n        transition: color 0.2s ease;\n      }\n\n      [data-spell-id] .styles_spellName__wX3ll a:hover {\n        color: #4a148c !important;\n        text-decoration: underline !important;\n      }\n    ",document.head.appendChild(e)}}},{key:"removeExtraSpells",value:function(){document.querySelectorAll("[data-spell-id]").forEach(function(e){e.remove()})}}],t&&k(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function C(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,M(a.key),a)}}function M(e){var t=function(e){if("object"!=z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==z(t)?t:t+""}const D=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"formatModifier",value:function(e){var t=Math.floor((e-10)/2);return t>=0?"+".concat(t):"".concat(t)}},{key:"calculateScaledHP",value:function(e,t,n,a){return t?e+t*Math.max(0,n-a):e}},{key:"formatAttackBonus",value:function(e,t,n){if("string"==typeof e&&e.includes("spell"))return e;var a=parseInt(e.replace("+",""));if(t>n){var i=t-n,o=a+Math.floor(i/2);return"+".concat(o)}return e}},{key:"formatDamage",value:function(e,t,n,a){if(!a||t<=n)return e;var i=t-n,o=Math.floor(i/2);return o>0?"".concat(e," + ").concat(o).concat(a.match(/\d*d\d+/)[0]):e}},{key:"renderStatBlock",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=n||a,o=(null===(t=e.baseStats)||void 0===t?void 0:t.stats)||e.stats,s=e.baseStats||e,r=this.calculateScaledHP(s.hp,s.hpPerLevel,i,a);return'\n      <div class="pet-stat-block">\n        <div class="pet-header">\n          <h3 class="pet-name">'.concat(e.name,'</h3>\n          <div class="pet-type">').concat(e.size," ").concat(e.type,'</div>\n        </div>\n        \n        <div class="pet-basic-stats">\n          <div class="stat-line">\n            <strong>Armor Class:</strong> ').concat(s.ac||"N/A",'\n          </div>\n          <div class="stat-line">\n            <strong>Hit Points:</strong> ').concat(r).concat(n?" (scaled to level ".concat(n,")"):"",'\n          </div>\n          <div class="stat-line">\n            <strong>Speed:</strong> ').concat(s.speed||"N/A","\n          </div>\n        </div>\n\n        ").concat(this.renderAbilityScores(o),"\n        ").concat(this.renderSkillsAndSenses(e),"\n        ").concat(this.renderResistancesAndImmunities(e),"\n        ").concat(this.renderAbilities(e.abilities),"\n        ").concat(this.renderActions(e.actions,i,a),"\n      </div>\n    ")}},{key:"renderAbilityScores",value:function(e){return e?'\n      <div class="ability-scores">\n        <div class="ability-score">\n          <div class="ability-name">STR</div>\n          <div class="ability-value">'.concat(e.str||10," (").concat(this.formatModifier(e.str||10),')</div>\n        </div>\n        <div class="ability-score">\n          <div class="ability-name">DEX</div>\n          <div class="ability-value">').concat(e.dex||10," (").concat(this.formatModifier(e.dex||10),')</div>\n        </div>\n        <div class="ability-score">\n          <div class="ability-name">CON</div>\n          <div class="ability-value">').concat(e.con||10," (").concat(this.formatModifier(e.con||10),')</div>\n        </div>\n        <div class="ability-score">\n          <div class="ability-name">INT</div>\n          <div class="ability-value">').concat(e.int||10," (").concat(this.formatModifier(e.int||10),')</div>\n        </div>\n        <div class="ability-score">\n          <div class="ability-name">WIS</div>\n          <div class="ability-value">').concat(e.wis||10," (").concat(this.formatModifier(e.wis||10),')</div>\n        </div>\n        <div class="ability-score">\n          <div class="ability-name">CHA</div>\n          <div class="ability-value">').concat(e.cha||10," (").concat(this.formatModifier(e.cha||10),")</div>\n        </div>\n      </div>\n    "):""}},{key:"renderSkillsAndSenses",value:function(e){var t="",n=e.baseStats||e;if(e.skills||n.skills){var a=e.skills||n.skills,i=Object.entries(a).map(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,o,s,r=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=o.call(n)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],a=t[1];return"".concat(n.charAt(0).toUpperCase()+n.slice(1)," +").concat(a)}).join(", ");t+='\n        <div class="stat-line">\n          <strong>Skills:</strong> '.concat(i,"\n        </div>\n      ")}if(e.senses||n.senses){var o=e.senses||n.senses;t+='\n        <div class="stat-line">\n          <strong>Senses:</strong> '.concat(o,"\n        </div>\n      ")}if(e.languages||n.languages){var s=e.languages||n.languages;t+='\n        <div class="stat-line">\n          <strong>Languages:</strong> '.concat(s,"\n        </div>\n      ")}return t}},{key:"renderResistancesAndImmunities",value:function(e){var t="",n=e.baseStats||e;if(e.damageResistance||n.damageResistance){var a=e.damageResistance||n.damageResistance;t+='\n        <div class="stat-line">\n          <strong>Damage Resistances:</strong> '.concat(a,"\n        </div>\n      ")}if(e.damageImmunity||n.damageImmunity){var i=e.damageImmunity||n.damageImmunity;t+='\n        <div class="stat-line">\n          <strong>Damage Immunities:</strong> '.concat(i,"\n        </div>\n      ")}if(e.conditionImmunity||n.conditionImmunity){var o=e.conditionImmunity||n.conditionImmunity;t+='\n        <div class="stat-line">\n          <strong>Condition Immunities:</strong> '.concat(o,"\n        </div>\n      ")}return t}},{key:"renderAbilities",value:function(e){return e&&0!==e.length?'\n      <div class="pet-abilities">\n        <h4>Special Abilities</h4>\n        '.concat(e.map(function(e){return'\n          <div class="ability">\n            <strong>'.concat(e.name,".</strong> ").concat(e.description,"\n          </div>\n        ")}).join(""),"\n      </div>\n    "):""}},{key:"renderActions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e&&0!==e.length?'\n      <div class="pet-actions">\n        <h4>Actions</h4>\n        '.concat(e.map(function(e){return t.renderAction(e,n,a)}).join(""),"\n      </div>\n    "):""}},{key:"renderAction",value:function(e,t,n){var a="";if("Melee Weapon Attack"===e.type||"Ranged Weapon Attack"===e.type){var i=this.formatAttackBonus(e.bonus,t,n),o=this.formatDamage(e.damage,t,n,e.scalingDamage);a="<em>".concat(e.type,":</em> ").concat(i," to hit, reach ").concat(e.reach||"5 ft.",", one target. \n                   <em>Hit:</em> ").concat(o,".")}else if("Melee Spell Attack"===e.type){var s=this.formatDamage(e.damage,t,n,e.scalingDamage);a="<em>".concat(e.type,":</em> ").concat(e.bonus," to hit, reach ").concat(e.reach||"5 ft.",", one target. \n                   <em>Hit:</em> ").concat(s,".")}else if("Area Effect"===e.type){var r=this.formatDamage(e.damage,t,n,e.scalingDamage);a="".concat(e.area,", ").concat(e.save," save. <em>Effect:</em> ").concat(r,".")}else a=e.description||"";return e.additionalEffect&&(a+=" ".concat(e.additionalEffect)),'\n      <div class="action">\n        <strong>'.concat(e.name,".</strong> ").concat(a,"\n      </div>\n    ")}},{key:"renderSpellLevelSelector",value:function(e){return!e.scalingLevels||e.scalingLevels.length<=1?"":'\n      <div class="spell-level-selector">\n        <label for="spell-level-select">Cast at Level:</label>\n        <select id="spell-level-select" class="spell-level-select">\n          '.concat(e.scalingLevels.map(function(t){return'\n            <option value="'.concat(t,'" ').concat(t===e.summonLevel?"selected":"",">\n              ").concat(t).concat(1===t?"st":2===t?"nd":3===t?"rd":"th"," Level\n            </option>\n          ")}).join(""),"\n        </select>\n      </div>\n    ")}},{key:"renderPetOptions",value:function(e){var t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||e.summonLevel;return'\n      <div class="pet-options">\n        '.concat(e.options.map(function(i,o){var s=null==n?void 0:n.isPetActive(e.spellKey||Object.keys(window.petsData||{}).find(function(t){return window.petsData[t]===e}),o),r=(null==n?void 0:n.getActivePetsByType(e.spellKey||Object.keys(window.petsData||{}).find(function(t){return window.petsData[t]===e}),o).length)||0;return'\n            <div class="pet-option '.concat(s?"has-active-pets":"",'" data-pet-index="').concat(o,'">\n              <div class="pet-option-header">\n                <div class="pet-header-main">\n                  <h4>').concat(i.name,"</h4>\n                  ").concat(i.maxCount?'<span class="max-count">Max: '.concat(i.maxCount,"</span>"):"","\n                  ").concat(r>0?'<span class="active-pets-indicator">'.concat(r," active</span>"):"",'\n                </div>\n                <div class="pet-header-controls">\n                  <button class="activate-pet-btn" \n                          data-spell-key="').concat(e.spellKey||"",'" \n                          data-pet-index="').concat(o,'"\n                          data-spell-level="').concat(a,'">\n                    + Activate\n                  </button>\n                </div>\n              </div>\n              <div class="pet-option-content">\n                ').concat(t.renderStatBlock(i,a,e.summonLevel),"\n              </div>\n            </div>\n          ")}).join(""),"\n      </div>\n    ")}},{key:"renderPetSummaryCard",value:function(e){return'\n      <div class="pet-summary-card">\n        <h3>'.concat(e.name,'</h3>\n        <p class="pet-description">').concat(e.description,'</p>\n        <div class="pet-summary-stats">\n          <span class="spell-level">Spell Level: ').concat(e.summonLevel,'</span>\n          <span class="option-count">').concat(e.options.length," option").concat(1!==e.options.length?"s":"","</span>\n        </div>\n      </div>\n    ")}}],null&&C(e.prototype,null),t&&C(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();var A={"find-familiar":{name:"Find Familiar",description:"Familiar creatures from Find Familiar spell",summonLevel:1,options:[{name:"Owl",size:"Tiny",type:"Beast",ac:11,hp:1,speed:"5 ft., fly 60 ft.",stats:{str:3,dex:13,con:8,int:2,wis:12,cha:7},skills:{perception:3,stealth:3},senses:"Darkvision 120 ft., passive Perception 13",abilities:[{name:"Flyby",description:"The owl doesn't provoke opportunity attacks when it flies out of an enemy's reach."},{name:"Keen Hearing and Sight",description:"The owl has advantage on Wisdom (Perception) checks that rely on hearing or sight."}],actions:[{name:"Talons",type:"Melee Weapon Attack",bonus:"+3",reach:"5 ft.",damage:"1 slashing damage"}]},{name:"Cat",size:"Tiny",type:"Beast",ac:12,hp:2,speed:"40 ft., climb 30 ft.",stats:{str:3,dex:15,con:10,int:3,wis:12,cha:7},skills:{perception:3,stealth:4},senses:"Passive Perception 13",abilities:[{name:"Keen Smell",description:"The cat has advantage on Wisdom (Perception) checks that rely on smell."}],actions:[{name:"Claws",type:"Melee Weapon Attack",bonus:"+0",reach:"5 ft.",damage:"1 slashing damage"}]},{name:"Raven",size:"Tiny",type:"Beast",ac:12,hp:1,speed:"10 ft., fly 50 ft.",stats:{str:2,dex:14,con:8,int:2,wis:12,cha:6},skills:{perception:3},senses:"Passive Perception 13",abilities:[{name:"Mimicry",description:"The raven can mimic simple sounds it has heard, such as a person whispering, a baby crying, or an animal chittering."}],actions:[{name:"Beak",type:"Melee Weapon Attack",bonus:"+4",reach:"5 ft.",damage:"1 piercing damage"}]}]},"summon-draconic-spirit":{name:"Summon Draconic Spirit",description:"Draconic spirit from 5th level spell",summonLevel:5,scalingLevels:[5,6,7,8,9],options:[{name:"Draconic Spirit",size:"Large",type:"Dragon",baseStats:{ac:14,hp:50,hpPerLevel:10,speed:"30 ft., fly 60 ft., swim 30 ft.",stats:{str:19,dex:14,con:17,int:10,wis:14,cha:14},damageResistance:"Chosen damage type",conditionImmunity:"Charmed, frightened, poisoned",senses:"Blindsight 30 ft., darkvision 60 ft., passive Perception 12",languages:"Draconic, understands the languages you speak"},abilities:[{name:"Shared Resistances",description:"When you summon the dragon, choose a damage type: acid, cold, fire, lightning, or poison. The dragon has resistance to that damage type."}],actions:[{name:"Multiattack",description:"The dragon makes a number of Rend attacks equal to half the spell slot level (rounded down).",scaling:!0},{name:"Rend",type:"Melee Weapon Attack",bonus:"+7",reach:"10 ft.",damage:"1d6 + 4 + spell level piercing damage",scaling:!0},{name:"Breath Weapon (Recharge 5-6)",type:"Area Effect",save:"Dexterity",area:"30-foot cone",damage:"Spell level d6 of chosen damage type",scaling:!0}]}]},"animate-objects":{name:"Animate Objects",description:"Animated objects from 5th level spell",summonLevel:5,options:[{name:"Tiny Animated Object",size:"Tiny",ac:18,hp:20,speed:"30 ft.",stats:{str:4,dex:18,con:10},attackBonus:"+8",damage:"1d4 + 4",maxCount:10},{name:"Small Animated Object",size:"Small",ac:16,hp:25,speed:"25 ft.",stats:{str:6,dex:14,con:10},attackBonus:"+6",damage:"1d8 + 2",maxCount:5},{name:"Medium Animated Object",size:"Medium",ac:13,hp:40,speed:"20 ft.",stats:{str:10,dex:12,con:10},attackBonus:"+5",damage:"2d6 + 1",maxCount:2},{name:"Large Animated Object",size:"Large",ac:10,hp:50,speed:"15 ft.",stats:{str:14,dex:10,con:10},attackBonus:"+6",damage:"2d10 + 2",maxCount:1}]},"conjure-animals":{name:"Conjure Animals",description:"Summon fey spirits that take the form of beasts",summonLevel:3,scalingLevels:[3,5,7,9],options:[{name:"Wolf",size:"Medium",type:"Beast",ac:13,hp:11,speed:"40 ft.",stats:{str:12,dex:15,con:12,int:3,wis:12,cha:6},skills:{perception:3,stealth:4},senses:"Passive Perception 13",abilities:[{name:"Pack Tactics",description:"The wolf has advantage on attack rolls against a creature if at least one of the wolf's allies is within 5 feet of the creature and the ally isn't incapacitated."}],actions:[{name:"Bite",type:"Melee Weapon Attack",bonus:"+4",reach:"5 ft.",damage:"2d4 + 2 piercing damage",additionalEffect:"Target must succeed on a DC 11 Strength saving throw or be knocked prone"}]},{name:"Giant Wolf Spider",size:"Medium",type:"Beast",ac:13,hp:11,speed:"40 ft., climb 40 ft.",stats:{str:12,dex:16,con:13,int:3,wis:12,cha:4},skills:{perception:3,stealth:7},senses:"Blindsight 10 ft., darkvision 60 ft., passive Perception 13",abilities:[{name:"Spider Climb",description:"The spider can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."},{name:"Web Sense",description:"While in contact with a web, the spider knows the exact location of any other creature in contact with the same web."}],actions:[{name:"Bite",type:"Melee Weapon Attack",bonus:"+5",reach:"5 ft.",damage:"1d8 + 3 piercing damage",additionalEffect:"Target must make a DC 11 Constitution saving throw, taking 2d8 poison damage on a failed save, or half as much on a successful one. If the poison damage reduces the target to 0 hit points, the target is stable but poisoned for 1 hour."}]}]},"bigbys-hand":{name:"Bigby's Hand",description:"Create a Large hand of shimmering, translucent force",summonLevel:5,options:[{name:"Bigby's Hand",size:"Large",type:"Force Construct",ac:20,hp:"Equal to your hit point maximum",speed:"60 ft.",stats:{str:26,dex:10,con:"-",int:"-",wis:"-",cha:"-"},damageImmunity:"Poison, psychic",conditionImmunity:"All conditions",abilities:[{name:"Clenched Fist",description:"Melee Spell Attack: +8 to hit, 2d6 + spell ability modifier force damage"},{name:"Forceful Hand",description:"Push a creature, Strength check vs your spell attack"},{name:"Grasping Hand",description:"Grapple a creature, Strength (Athletics) check vs your spell attack"},{name:"Interposing Hand",description:"Provides half cover, disadvantage on attacks through it"}]}]},"spiritual-weapon":{name:"Spiritual Weapon",description:"Create a floating spectral weapon",summonLevel:2,scalingLevels:[2,3,4,5,6,7,8,9],options:[{name:"Spiritual Weapon",size:"Medium",type:"Force Construct",ac:"-",hp:"-",speed:"20 ft. (no opportunity attacks)",abilities:[{name:"Spectral Weapon",description:"Cannot be targeted or damaged"}],actions:[{name:"Spectral Attack",type:"Melee Spell Attack",bonus:"Spell attack modifier",reach:"5 ft.",damage:"1d8 + spell ability modifier force damage",scaling:!0,scalingDamage:"+1d8 per 2 spell levels above 2nd"}]}]}};Object.assign(A,{"conjure-celestial":{name:"Conjure Celestial",description:"Summon a celestial spirit (Cleric 7th). Wish can duplicate this up to 8th-level.",summonLevel:7,scalingLevels:[7,8],options:[{name:"Couatl (CR 4)",size:"Medium",type:"Celestial",ac:19,hp:97,speed:"30 ft., fly 90 ft.",stats:{str:16,dex:20,con:17,int:18,wis:20,cha:18},savingThrows:{con:6,wis:7,cha:7},skills:{insight:7,perception:7},senses:"Truesight 120 ft., passive Perception 17",languages:"All, telepathy 120 ft.",abilities:[{name:"Magic Resistance",description:"Advantage on saving throws against spells and other magical effects."},{name:"Innate Spellcasting",description:"Includes invisibility, detect thoughts, etc. (per MM). Uses Charisma."},{name:"Shapeshift",description:"Can magically polymorph (per MM)."}],actions:[{name:"Bite",type:"Melee Weapon Attack",bonus:"+8",reach:"5 ft.",damage:"1d6 + 3 piercing + 3d6 poison"},{name:"Constrict",type:"Melee Weapon Attack",bonus:"+6",reach:"10 ft.",damage:"2d6 + 3 bludgeoning; target grappled (escape DC 15), restrained while grappled"}]},{name:"Pegasus (CR 2)",size:"Large",type:"Celestial",ac:12,hp:59,speed:"60 ft., fly 90 ft.",stats:{str:18,dex:15,con:16,int:10,wis:15,cha:13},skills:{perception:6},senses:"Passive Perception 16",languages:"Understands Celestial, Common, Elvish, Sylvan but can’t speak",abilities:[{name:"Keen Sight",description:"Advantage on Wisdom (Perception) checks that rely on sight."}],actions:[{name:"Hooves",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d6 + 4 bludgeoning"}]}]},"conjure-fey":{name:"Conjure Fey",description:"Summon a fey creature (Druid 6th). Wish can duplicate up to 8th-level.",summonLevel:6,scalingLevels:[6,7,8],options:[{name:"Annis Hag (CR 6)",size:"Large",type:"Fey",ac:17,hp:75,speed:"40 ft., climb 40 ft.",stats:{str:21,dex:12,con:14,int:13,wis:14,cha:14},senses:"Darkvision 60 ft., passive Perception 12",abilities:[{name:"Crushing Hug",description:"On a grappled target, bonus damage/conditions (per VGtM/MMoM entry)."}],actions:[{name:"Multiattack",description:"Makes three Claw attacks."},{name:"Claw",type:"Melee Weapon Attack",bonus:"+8",reach:"5 ft.",damage:"2d6 + 5 slashing"}]},{name:"Korred (CR 7)",size:"Small",type:"Fey",ac:17,hp:102,speed:"30 ft., burrow 20 ft.",stats:{str:19,dex:14,con:16,int:10,wis:14,cha:16},senses:"Darkvision 120 ft., tremorsense 60 ft., passive Perception 12",abilities:[{name:"Earth Glide",description:"Move through nonmagical earth and stone."},{name:"Magic Resistance",description:"Advantage on saves vs. spells and magical effects."}],actions:[{name:"Hair Rope",type:"Melee Weapon Attack",bonus:"+7",reach:"30 ft.",damage:"1d4 + 4 slashing; grapple on hit (escape DC 15)"},{name:"Greatclub",type:"Melee Weapon Attack",bonus:"+7",reach:"5 ft.",damage:"2d8 + 4 bludgeoning"}]},{name:"Yeth Hound (CR 4)",size:"Large",type:"Fey",ac:15,hp:51,speed:"40 ft., fly 40 ft. (hover)",stats:{str:16,dex:17,con:16,int:5,wis:12,cha:7},senses:"Darkvision 60 ft., passive Perception 11",abilities:[{name:"Baleful Baying",description:"Frighten creatures that can hear it (per VGtM/MMoM entry)."},{name:"Sunlight Banishment",description:"Vanishes in sunlight (per entry)."}],actions:[{name:"Bite",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d6 + 3 piercing"}]}]},"conjure-woodland-beings":{name:"Conjure Woodland Beings",description:"Summon fey creatures in groups (Druid 4th). The infamous pixie polymorph combo lives here.",summonLevel:4,scalingLevels:[4,6,8],options:[{name:"Pixie (CR 1/4) x8",size:"Tiny",type:"Fey",ac:15,hp:1,speed:"10 ft., fly 30 ft.",stats:{str:2,dex:20,con:8,int:10,wis:14,cha:15},senses:"Passive Perception 12",abilities:[{name:"Innate Spellcasting",description:"Includes polymorph, greater invisibility, fly, etc. (per MM). Uses Charisma."},{name:"Magic Resistance",description:"Advantage on saves vs. spells and magical effects."}],actions:[{name:"Shortbow",type:"Ranged Weapon Attack",bonus:"+7",range:"80/320 ft.",damage:"1d6 + 5 piercing"}],maxCount:8}]},"infernal-calling":{name:"Infernal Calling",description:"Call a devil (XGtE 5th). With Wish you can duplicate up to 8th, so up to CR 8.",summonLevel:5,scalingLevels:[5,6,7,8],options:[{name:"Barbed Devil (CR 5)",size:"Medium",type:"Fiend (Devil)",ac:15,hp:110,speed:"30 ft.",stats:{str:16,dex:17,con:18,int:12,wis:14,cha:14},damageResistance:"Cold; bludgeoning, piercing, and slashing from nonmagical attacks not made with silvered weapons",damageImmunity:"Fire, poison",conditionImmunity:"Poisoned",senses:"Darkvision 120 ft., passive Perception 12",languages:"Infernal, telepathy 120 ft.",abilities:[{name:"Magic Resistance",description:"Advantage on saves vs. spells and magical effects."},{name:"Barbed Hide",description:"Creatures grappling the devil take piercing damage (per MM)."}],actions:[{name:"Multiattack",description:"Makes three attacks: Claw, Claw, Tail."},{name:"Claw",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d6 + 3 slashing"},{name:"Tail",type:"Melee Weapon Attack",bonus:"+6",reach:"10 ft.",damage:"2d6 + 3 piercing"}]},{name:"Chain Devil (CR 8)",size:"Medium",type:"Fiend (Devil)",ac:16,hp:85,speed:"30 ft.",stats:{str:18,dex:15,con:18,int:11,wis:12,cha:14},damageResistance:"Cold; bludgeoning, piercing, and slashing from nonmagical attacks not made with silvered weapons",damageImmunity:"Fire, poison",conditionImmunity:"Charmed, frightened, poisoned",senses:"Darkvision 120 ft., passive Perception 11",languages:"Infernal, telepathy 120 ft.",abilities:[{name:"Devil’s Sight",description:"Magical darkness doesn’t impede darkvision."},{name:"Magic Resistance",description:"Advantage on saves vs. spells and magical effects."},{name:"Animate Chains",description:"Can animate chains to restrain/attack (per MM)."}],actions:[{name:"Multiattack",description:"Makes two Chain attacks."},{name:"Chain",type:"Melee Weapon Attack",bonus:"+8",reach:"10 ft.",damage:"2d6 + 4 slashing; grapple and restrain on hit (escape DC 14)"}]}]},"conjure-elemental":{name:"Conjure Elemental",description:"Summon an elemental (Druid/Wizard 5th). Wish can duplicate this up to 8th-level.",summonLevel:5,scalingLevels:[5,6,7,8],options:[{name:"Air Elemental (CR 5)",size:"Large",type:"Elemental",ac:15,hp:90,speed:"0 ft., fly 90 ft. (hover)",stats:{str:14,dex:20,con:14,int:6,wis:10,cha:6},damageImmunity:"Poison",conditionImmunity:"Exhaustion, grappled, paralyzed, petrified, poisoned, prone, restrained, unconscious",senses:"Darkvision 60 ft., passive Perception 10",languages:"Auran",abilities:[{name:"Air Form",description:"Can move through a space as narrow as 1 inch wide; can enter a hostile creature’s space."},{name:"Whirlwind (Recharge 4–6)",description:"Area effect that knocks prone/throws creatures (per MM)."}],actions:[{name:"Slam",type:"Melee Weapon Attack",bonus:"+8",reach:"5 ft.",damage:"2d8 + 5 bludgeoning"}]},{name:"Earth Elemental (CR 5)",size:"Large",type:"Elemental",ac:17,hp:126,speed:"30 ft., burrow 30 ft.",stats:{str:20,dex:8,con:20,int:5,wis:10,cha:5},damageResistance:"Bludgeoning, piercing, slashing from nonmagical attacks",damageImmunity:"Poison",conditionImmunity:"Exhaustion, paralyzed, petrified, poisoned, unconscious",senses:"Darkvision 60 ft., tremorsense 60 ft., passive Perception 10",languages:"Terran",abilities:[{name:"Earth Glide",description:"Move through nonmagical, unworked earth and stone."}],actions:[{name:"Slam",type:"Melee Weapon Attack",bonus:"+8",reach:"5 ft.",damage:"2d8 + 5 bludgeoning"}]},{name:"Fire Elemental (CR 5)",size:"Large",type:"Elemental",ac:13,hp:102,speed:"50 ft.",stats:{str:10,dex:17,con:16,int:6,wis:10,cha:7},damageImmunity:"Fire, poison",conditionImmunity:"Exhaustion, grappled, paralyzed, petrified, poisoned, prone, restrained, unconscious",senses:"Darkvision 60 ft., passive Perception 10",languages:"Ignan",abilities:[{name:"Fire Form",description:"Enter a creature’s space; sets foes on fire on hit/move-through."}],actions:[{name:"Touch",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d6 + 3 fire (targets ignite on hit; take ongoing fire damage)"}]},{name:"Water Elemental (CR 5)",size:"Large",type:"Elemental",ac:14,hp:114,speed:"30 ft., swim 90 ft.",stats:{str:18,dex:14,con:18,int:5,wis:10,cha:8},damageResistance:"Acid; bludgeoning, piercing, slashing from nonmagical attacks",damageImmunity:"Poison",conditionImmunity:"Exhaustion, grappled, paralyzed, petrified, poisoned, prone, restrained, unconscious",senses:"Darkvision 60 ft., passive Perception 10",languages:"Aquan",abilities:[{name:"Freeze",description:"Cold damage partially freezes it (per MM)."},{name:"Whelm (Recharge 4–6)",description:"Engulf and restrain creatures; deals bludgeoning each turn."}],actions:[{name:"Slam",type:"Melee Weapon Attack",bonus:"+7",reach:"5 ft.",damage:"2d8 + 4 bludgeoning"}]},{name:"Invisible Stalker (CR 6)",size:"Medium",type:"Elemental",ac:14,hp:104,speed:"50 ft., fly 50 ft. (hover)",stats:{str:16,dex:19,con:14,int:10,wis:15,cha:11},conditionImmunity:"Exhaustion, grappled, paralyzed, petrified, poisoned, prone, restrained, unconscious",senses:"Darkvision 60 ft., passive Perception 15",languages:"Auran, understands Common but doesn’t speak",abilities:[{name:"Invisibility",description:"Invisible while not attacking (per MM behavior)."},{name:"Faultless Tracker",description:"Knows direction/distance to target it was assigned to track."}],actions:[{name:"Multiattack",description:"Makes two Slam attacks."},{name:"Slam",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d6 + 4 bludgeoning"}]},{name:"Galeb Duhr (CR 6)",size:"Medium",type:"Elemental",ac:16,hp:85,speed:"15 ft.",stats:{str:20,dex:14,con:20,int:11,wis:12,cha:11},damageResistance:"Bludgeoning, piercing, slashing from nonmagical attacks",conditionImmunity:"Petrified, poisoned",senses:"Darkvision 60 ft., tremorsense 60 ft., passive Perception 11",languages:"Terran",abilities:[{name:"False Appearance",description:"Indistinguishable from a boulder while motionless."},{name:"Animate Boulders (1/day)",description:"Animates two boulders (per MM)."}],actions:[{name:"Multiattack",description:"Makes two Slam attacks."},{name:"Slam",type:"Melee Weapon Attack",bonus:"+8",reach:"5 ft.",damage:"2d6 + 5 bludgeoning"}]}]},"summon-greater-demon":{name:"Summon Greater Demon",description:"Summon a demon (XGtE 4th). With Wish you can duplicate up to 8th-level (cap CR 9).",summonLevel:4,scalingLevels:[4,5,6,7,8],options:[{name:"Barlgura (CR 5)",size:"Large",type:"Fiend (Demon)",ac:15,hp:68,speed:"40 ft., climb 40 ft.",stats:{str:18,dex:15,con:16,int:7,wis:14,cha:9},senses:"Darkvision 60 ft., passive Perception 12",languages:"Abyssal",abilities:[{name:"Reckless",description:"Gains advantage on melee, but attacks against it have advantage until next turn."},{name:"Spellcasting",description:"Disguise self and invisibility (per MM)."}],actions:[{name:"Multiattack",description:"Makes three attacks: Bite and two Fists."},{name:"Bite",type:"Melee Weapon Attack",bonus:"+7",reach:"5 ft.",damage:"2d6 + 4 piercing"},{name:"Fist",type:"Melee Weapon Attack",bonus:"+7",reach:"5 ft.",damage:"2d8 + 4 bludgeoning"}]},{name:"Vrock (CR 6)",size:"Large",type:"Fiend (Demon)",ac:15,hp:104,speed:"40 ft., fly 60 ft.",stats:{str:17,dex:15,con:18,int:8,wis:13,cha:8},senses:"Darkvision 120 ft., passive Perception 11",languages:"Abyssal, telepathy 120 ft.",abilities:[{name:"Spore Cloud (Recharge 6)",description:"Poison spores (per MM)."},{name:"Stunning Screech (1/Day)",description:"Stuns nearby creatures (per MM)."}],actions:[{name:"Multiattack",description:"Makes two attacks: Beak and Talons."},{name:"Beak",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d6 + 3 piercing"},{name:"Talons",type:"Melee Weapon Attack",bonus:"+6",reach:"5 ft.",damage:"2d10 + 3 slashing"}]},{name:"Hezrou (CR 8)",size:"Large",type:"Fiend (Demon)",ac:16,hp:136,speed:"30 ft.",stats:{str:19,dex:17,con:20,int:5,wis:12,cha:13},senses:"Darkvision 120 ft., passive Perception 11",languages:"Abyssal, telepathy 120 ft.",abilities:[{name:"Magic Resistance",description:"Advantage on saves vs. spells and magical effects."},{name:"Stench",description:"Creatures starting turn in aura must save or be poisoned (per MM)."}],actions:[{name:"Multiattack",description:"Makes three attacks: Bite and two Claws."},{name:"Bite",type:"Melee Weapon Attack",bonus:"+7",reach:"5 ft.",damage:"2d10 + 4 piercing"},{name:"Claw",type:"Melee Weapon Attack",bonus:"+7",reach:"5 ft.",damage:"2d6 + 4 slashing"}]},{name:"Glabrezu (CR 9)",size:"Large",type:"Fiend (Demon)",ac:17,hp:157,speed:"40 ft.",stats:{str:20,dex:15,con:21,int:19,wis:17,cha:16},senses:"Truesight 120 ft., passive Perception 13",languages:"Abyssal, telepathy 120 ft.",abilities:[{name:"Magic Resistance",description:"Advantage on saves vs. spells and magical effects."},{name:"Innate Spellcasting",description:"Includes darkness, dispel magic, power word stun (per MM limits)."}],actions:[{name:"Multiattack",description:"Makes two Pincer attacks and two Fist attacks."},{name:"Pincer",type:"Melee Weapon Attack",bonus:"+9",reach:"10 ft.",damage:"2d10 + 5 bludgeoning; grapple on hit (escape DC 15)"},{name:"Fist",type:"Melee Weapon Attack",bonus:"+9",reach:"5 ft.",damage:"2d4 + 5 bludgeoning"}]}]}});const E=A;function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){O(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,H(a.key),a)}}function O(e,t,n){return(t=H(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e){var t=function(e){if("object"!=L(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==L(t)?t:t+""}var I=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"getActivePets",value:function(){try{var e=localStorage.getItem(this.STORAGE_KEY);if(!e)return{pets:[],lastZIndex:1e3};var t=JSON.parse(e);return{pets:Array.isArray(t.pets)?t.pets:[],lastZIndex:t.lastZIndex||1e3}}catch(e){return console.warn("Failed to load active pets from localStorage:",e),{pets:[],lastZIndex:1e3}}}},{key:"saveActivePets",value:function(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Failed to save active pets to localStorage:",e)}}},{key:"addActivePet",value:function(e){var t=this.getActivePets();return t.pets.push(j(j({},e),{},{id:this.generateId(),createdAt:(new Date).toISOString(),lastModified:(new Date).toISOString()})),this.saveActivePets(t),t.pets[t.pets.length-1]}},{key:"updateActivePet",value:function(e,t){var n=this.getActivePets(),a=n.pets.findIndex(function(t){return t.id===e});return-1!==a?(n.pets[a]=j(j(j({},n.pets[a]),t),{},{lastModified:(new Date).toISOString()}),this.saveActivePets(n),n.pets[a]):null}},{key:"removeActivePet",value:function(e){var t=this.getActivePets();return t.pets=t.pets.filter(function(t){return t.id!==e}),this.saveActivePets(t),t}},{key:"getNextZIndex",value:function(){var e=this.getActivePets();return e.lastZIndex+=1,this.saveActivePets(e),e.lastZIndex}},{key:"generateId",value:function(){return"pet_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"clearAllActivePets",value:function(){localStorage.removeItem(this.STORAGE_KEY)}},{key:"validatePetData",value:function(e){return["spellKey","petIndex","instanceName"].every(function(t){return e.hasOwnProperty(t)})}}],null&&_(e.prototype,null),t&&_(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();O(I,"STORAGE_KEY","dndbeyond-toolbelt-active-pets");const F=I;function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach(function(t){q(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function q(e,t,n){return(t=U(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,U(a.key),a)}}function U(e){var t=function(e){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==B(t)?t:t+""}const K=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id,this.manager=n,this.petData=t,this.card=null,this.isMinimized=t.isMinimized||!1,this.isDragging=!1,this.isResizing=!1,this.dragData={},this.resizeData={},this.render(),this.setupEventListeners(),this.restorePosition()},t=[{key:"render",value:function(){var e=E[this.petData.spellKey],t=null==e?void 0:e.options[this.petData.petIndex];t?(this.card=document.createElement("div"),this.card.className="active-pet-card",this.card.setAttribute("data-pet-id",this.id),this.card.style.zIndex=this.petData.zIndex||1e3,this.isMinimized?this.renderMinimized():this.renderFull(t,e),document.body.appendChild(this.card)):console.error("Pet data not found for active pet:",this.petData)}},{key:"renderFull",value:function(e,t){var n=this.petData.stats,a=Math.max(0,n.currentHp/n.maxHp*100),i=a>60?"#4CAF50":a>30?"#FF9800":"#F44336";this.card.innerHTML='\n      <div class="active-pet-header">\n        <div class="active-pet-title">\n          <h3>'.concat(this.petData.instanceName,'</h3>\n          <span class="pet-type">').concat(e.size," ").concat(e.type,'</span>\n        </div>\n        <div class="active-pet-controls">\n          <button class="active-pet-btn minimize-btn" title="Minimize">−</button>\n          <button class="active-pet-btn close-btn" title="Close">×</button>\n        </div>\n      </div>\n\n      <div class="active-pet-hp-section">\n        <div class="hp-display">\n          <div class="hp-current">\n            <input type="number" \n                   class="hp-input" \n                   value="').concat(n.currentHp,'" \n                   min="0" \n                   max="').concat(n.maxHp+(n.tempHp||0),'"\n                   title="Current HP">\n            <span class="hp-separator">/</span>\n            <span class="hp-max">').concat(n.maxHp,"</span>\n            ").concat(n.tempHp?'<span class="hp-temp">+'.concat(n.tempHp,"</span>"):"",'\n          </div>\n        </div>\n        <div class="hp-bar">\n          <div class="hp-bar-fill" style="width: ').concat(a,"%; background-color: ").concat(i,';"></div>\n        </div>\n        <div class="hp-controls">\n          <div class="hp-control-group">\n            <label>Damage:</label>\n            <input type="number" class="damage-input" min="0" placeholder="0">\n            <button class="apply-damage-btn">Apply</button>\n          </div>\n          <div class="hp-control-group">\n            <label>Heal:</label>\n            <input type="number" class="heal-input" min="0" placeholder="0">\n            <button class="apply-heal-btn">Apply</button>\n          </div>\n          <div class="hp-control-group">\n            <label>Temp HP:</label>\n            <input type="number" class="temp-hp-input" min="0" placeholder="0" value="').concat(n.tempHp||0,'">\n            <button class="apply-temp-hp-btn">Set</button>\n          </div>\n        </div>\n        <div class="hp-quick-buttons">\n          <button class="quick-hp-btn" data-value="-5">-5</button>\n          <button class="quick-hp-btn" data-value="-1">-1</button>\n          <button class="quick-hp-btn" data-value="+1">+1</button>\n          <button class="quick-hp-btn" data-value="+5">+5</button>\n        </div>\n      </div>\n\n      <div class="active-pet-stats">\n        ').concat(D.renderStatBlock(e,this.petData.spellLevel||t.summonLevel,t.summonLevel),'\n      </div>\n\n      \x3c!-- Resize handles --\x3e\n      <div class="resize-handle resize-n" data-direction="n"></div>\n      <div class="resize-handle resize-ne" data-direction="ne"></div>\n      <div class="resize-handle resize-e" data-direction="e"></div>\n      <div class="resize-handle resize-se" data-direction="se"></div>\n      <div class="resize-handle resize-s" data-direction="s"></div>\n      <div class="resize-handle resize-sw" data-direction="sw"></div>\n      <div class="resize-handle resize-w" data-direction="w"></div>\n      <div class="resize-handle resize-nw" data-direction="nw"></div>\n    '),this.petData.size?(this.card.style.width=this.petData.size.width+"px",this.card.style.height=this.petData.size.height+"px"):(this.card.style.width="320px",this.card.style.height="500px")}},{key:"renderMinimized",value:function(){var e=this.petData.stats,t=Math.max(0,e.currentHp/e.maxHp*100);this.card.className="active-pet-card minimized",this.card.innerHTML='\n      <div class="minimized-pet-content">\n        <div class="minimized-pet-name">'.concat(this.petData.instanceName.split(" ")[0],'</div>\n        <div class="minimized-hp-bar">\n          <div class="minimized-hp-fill" style="width: ').concat(t,'%;"></div>\n        </div>\n        <div class="minimized-hp-text">').concat(e.currentHp,"/").concat(e.maxHp,'</div>\n        <button class="minimized-close-btn">×</button>\n      </div>\n    '),this.card.style.width="80px",this.card.style.height="60px"}},{key:"setupEventListeners",value:function(){var e=this,t=this.card.querySelector(".active-pet-header");t&&t.addEventListener("mousedown",this.startDrag.bind(this));var n=this.card.querySelector(".minimize-btn"),a=this.card.querySelector(".close-btn, .minimized-close-btn");n&&n.addEventListener("click",this.toggleMinimize.bind(this)),a&&a.addEventListener("click",this.close.bind(this)),this.setupHPControls(),this.setupResizeHandles(),this.isMinimized&&this.card.addEventListener("click",function(t){t.target.classList.contains("minimized-close-btn")||e.restore()}),this.card.addEventListener("mousedown",this.bringToFront.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this))}},{key:"setupHPControls",value:function(){var e=this,t=this.card.querySelector(".hp-input");t&&t.addEventListener("change",function(t){var n=Math.max(0,parseInt(t.target.value)||0);e.updateHP({currentHp:n})});var n=this.card.querySelector(".apply-damage-btn"),a=this.card.querySelector(".apply-heal-btn"),i=this.card.querySelector(".apply-temp-hp-btn");n&&n.addEventListener("click",function(){var t=e.card.querySelector(".damage-input"),n=parseInt(t.value)||0;n>0&&(e.applyDamage(n),t.value="")}),a&&a.addEventListener("click",function(){var t=e.card.querySelector(".heal-input"),n=parseInt(t.value)||0;n>0&&(e.applyHealing(n),t.value="")}),i&&i.addEventListener("click",function(){var t=e.card.querySelector(".temp-hp-input"),n=Math.max(0,parseInt(t.value)||0);e.updateHP({tempHp:n})}),this.card.querySelectorAll(".quick-hp-btn").forEach(function(t){t.addEventListener("click",function(){var n=parseInt(t.dataset.value);n<0?e.applyDamage(Math.abs(n)):e.applyHealing(n)})})}},{key:"setupResizeHandles",value:function(){var e=this;this.card.querySelectorAll(".resize-handle").forEach(function(t){t.addEventListener("mousedown",function(n){n.stopPropagation(),e.startResize(n,t.dataset.direction)})})}},{key:"startDrag",value:function(e){this.isMinimized||(this.isDragging=!0,this.dragData={startX:e.clientX,startY:e.clientY,startLeft:this.card.offsetLeft,startTop:this.card.offsetTop},this.card.style.cursor="grabbing",e.preventDefault())}},{key:"startResize",value:function(e,t){this.isMinimized||(e.preventDefault(),e.stopPropagation(),this.isResizing=!0,this.resizeData={direction:t,startX:e.clientX,startY:e.clientY,startWidth:this.card.offsetWidth,startHeight:this.card.offsetHeight,startLeft:this.card.offsetLeft,startTop:this.card.offsetTop},document.body.style.cursor=this.getResizeCursor(t),this.card.classList.add("resizing"))}},{key:"handleMouseMove",value:function(e){this.isDragging?this.handleDrag(e):this.isResizing&&this.handleResize(e)}},{key:"handleMouseUp",value:function(){this.isDragging?this.stopDrag():this.isResizing&&this.stopResize()}},{key:"handleDrag",value:function(e){var t=e.clientX-this.dragData.startX,n=e.clientY-this.dragData.startY,a=this.dragData.startLeft+t,i=this.dragData.startTop+n;a=Math.max(0,Math.min(a,window.innerWidth-this.card.offsetWidth)),i=Math.max(0,Math.min(i,window.innerHeight-this.card.offsetHeight)),this.card.style.left=a+"px",this.card.style.top=i+"px"}},{key:"handleResize",value:function(e){var t=e.clientX-this.resizeData.startX,n=e.clientY-this.resizeData.startY,a=this.resizeData.direction,i=this.resizeData.startWidth,o=this.resizeData.startHeight,s=this.resizeData.startLeft,r=this.resizeData.startTop;a.includes("e")&&(i+=t),a.includes("w")&&(i-=t,s+=t),a.includes("s")&&(o+=n),a.includes("n")&&(o-=n,r+=n),i=Math.max(250,i),o=Math.max(300,o),i=Math.min(600,i),o=Math.min(800,o),a.includes("w")&&250===i?s=this.resizeData.startLeft+(this.resizeData.startWidth-250):a.includes("w")&&(s=this.resizeData.startLeft+(this.resizeData.startWidth-i)),a.includes("n")&&300===o?r=this.resizeData.startTop+(this.resizeData.startHeight-300):a.includes("n")&&(r=this.resizeData.startTop+(this.resizeData.startHeight-o)),s=Math.max(0,Math.min(s,window.innerWidth-i)),r=Math.max(0,Math.min(r,window.innerHeight-o)),this.card.style.width=i+"px",this.card.style.height=o+"px",this.card.style.left=s+"px",this.card.style.top=r+"px",this.petData.size={width:i,height:o},this.petData.position={x:s,y:r}}},{key:"stopDrag",value:function(){this.isDragging=!1,this.card.style.cursor="default",this.savePosition()}},{key:"stopResize",value:function(){this.isResizing=!1,document.body.style.cursor="default",this.card.classList.remove("resizing"),this.manager.saveState()}},{key:"getResizeCursor",value:function(e){return{n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize",nw:"nwse-resize"}[e]||"default"}},{key:"bringToFront",value:function(){var e=this.manager.getNextZIndex();this.card.style.zIndex=e,this.petData.zIndex=e,this.manager.updatePetData(this.id,{zIndex:e})}},{key:"toggleMinimize",value:function(){this.isMinimized?this.restore():this.minimize()}},{key:"minimize",value:function(){if(!this.isMinimized){var e=this.card.getBoundingClientRect();this.petData.position={x:e.left,y:e.top},this.petData.size={width:e.width,height:e.height},this.isMinimized=!0,this.petData.isMinimized=!0,this.card.style.display="none",this.createMinimizedButton(),this.manager.saveState()}}},{key:"createMinimizedButton",value:function(){var e=this;this.minimizedButton&&this.minimizedButton.remove(),this.minimizedButton=document.createElement("div"),this.minimizedButton.className="active-pet-minimized",this.minimizedButton.innerHTML='\n      <div class="minimized-pet-icon">🐾</div>\n      <div class="minimized-pet-tooltip">\n        <div class="tooltip-name">'.concat(this.petData.instanceName,'</div>\n        <div class="tooltip-hp">HP: ').concat(this.petData.stats.currentHp,"/").concat(this.petData.stats.maxHp,"</div>\n      </div>\n    ");var t=this.manager.getMinimizedIndex(this.petData.id),n=90+70*Math.floor(t/4),a=20+t%4*70;this.minimizedButton.style.bottom="".concat(n,"px"),this.minimizedButton.style.right="".concat(a,"px"),this.minimizedButton.addEventListener("click",function(){return e.restore()}),document.body.appendChild(this.minimizedButton)}},{key:"restore",value:function(){this.isMinimized&&(this.isMinimized=!1,this.petData.isMinimized=!1,this.minimizedButton&&(this.minimizedButton.remove(),this.minimizedButton=null),this.card.style.display="block",this.petData.position&&(this.card.style.left="".concat(this.petData.position.x,"px"),this.card.style.top="".concat(this.petData.position.y,"px")),this.petData.size&&(this.card.style.width="".concat(this.petData.size.width,"px"),this.card.style.height="".concat(this.petData.size.height,"px")),this.manager.saveState(),this.manager.updateMinimizedPositions())}},{key:"close",value:function(){this.destroy(),this.manager.deactivatePet(this.id)}},{key:"applyDamage",value:function(e){var t=this.petData.stats,n=e;if(t.tempHp>0){var a=Math.min(t.tempHp,n);t.tempHp-=a,n-=a}t.currentHp=Math.max(0,t.currentHp-n),this.updateHP(t)}},{key:"applyHealing",value:function(e){var t=this.petData.stats;t.currentHp=Math.min(t.maxHp,t.currentHp+e),this.updateHP(t)}},{key:"updateHP",value:function(e){this.petData.stats=W(W({},this.petData.stats),e),this.manager.updatePetData(this.id,{stats:this.petData.stats}),this.updateHPDisplay()}},{key:"updateHPDisplay",value:function(){var e=this.petData.stats,t=this.card.querySelector(".hp-input"),n=this.card.querySelector(".hp-max"),a=this.card.querySelector(".hp-temp"),i=this.card.querySelector(".hp-bar-fill, .minimized-hp-fill"),o=this.card.querySelector(".minimized-hp-text");t&&(t.value=e.currentHp),n&&(n.textContent=e.maxHp),a&&(e.tempHp>0?(a.textContent="+".concat(e.tempHp),a.style.display="inline"):a.style.display="none");var s=Math.max(0,e.currentHp/e.maxHp*100),r=s>60?"#4CAF50":s>30?"#FF9800":"#F44336";i&&(i.style.width=s+"%",i.style.backgroundColor=r),o&&(o.textContent="".concat(e.currentHp,"/").concat(e.maxHp))}},{key:"savePosition",value:function(){var e={x:this.card.offsetLeft,y:this.card.offsetTop},t={width:this.card.offsetWidth,height:this.card.offsetHeight};this.manager.updatePetData(this.id,{position:e,size:t})}},{key:"restorePosition",value:function(){if(this.petData.position)this.card.style.left=this.petData.position.x+"px",this.card.style.top=this.petData.position.y+"px";else{var e=30*(this.manager.getActiveCount()-1);this.card.style.left=100+e+"px",this.card.style.top=100+e+"px"}}},{key:"destroy",value:function(){this.minimizedButton&&(this.minimizedButton.remove(),this.minimizedButton=null),this.card&&this.card.parentNode&&this.card.parentNode.removeChild(this.card),this.card=null}}],t&&N(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function X(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Y(a.key),a)}}function Y(e){var t=function(e){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==G(t)?t:t+""}const V=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activePets=new Map,this.nextInstanceNumbers=new Map,this.minimizedCards=new Set,this.floatingButton=null,this.init()},t=[{key:"init",value:function(){this.findFloatingButton(),this.loadSavedPets()}},{key:"findFloatingButton",value:function(){this.floatingButton=document.querySelector(".pets-floating-btn")}},{key:"loadSavedPets",value:function(){var e=this;F.getActivePets().pets.forEach(function(t){if(F.validatePetData(t)){e.createPetCard(t);var n="".concat(t.spellKey,"-").concat(t.petIndex),a=e.extractInstanceNumber(t.instanceName);a>0&&e.nextInstanceNumbers.set(n,Math.max(e.nextInstanceNumbers.get(n)||1,a+1))}})}},{key:"activatePet",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=E[e],i=null==a?void 0:a.options[t];if(!i||!a)return console.error("Pet not found:",e,t),null;var o="".concat(e,"-").concat(t),s=this.nextInstanceNumbers.get(o)||1;this.nextInstanceNumbers.set(o,s+1);var r="".concat(i.name," #").concat(s),l=n||a.summonLevel,c=i.baseStats||i,d=(c.stats||i.stats,c.hp||i.hp||10);if(c.hpPerLevel&&l>a.summonLevel){var p=l-a.summonLevel;d+=c.hpPerLevel*p}var u={spellKey:e,petIndex:t,spellLevel:l,instanceName:r,position:null,size:null,isMinimized:!1,zIndex:F.getNextZIndex(),stats:{currentHp:d,maxHp:d,tempHp:0,maxHpOverride:null}},m=F.addActivePet(u),h=this.createPetCard(m);return console.log("🐾 Activated pet: ".concat(r)),h}},{key:"createPetCard",value:function(e){var t=new K(e,this);return this.activePets.set(e.id,t),e.isMinimized&&(this.minimizedCards.add(e.id),this.repositionMinimizedCards()),t}},{key:"deactivatePet",value:function(e){var t=this.activePets.get(e);return!!t&&(t.destroy(),this.activePets.delete(e),this.minimizedCards.delete(e),F.removeActivePet(e),this.repositionMinimizedCards(),console.log("🐾 Deactivated pet: ".concat(e)),!0)}},{key:"updatePetData",value:function(e,t){var n=this.activePets.get(e);return!!n&&(Object.assign(n.petData,t),F.updateActivePet(e,t),!0)}},{key:"getActivePet",value:function(e){return this.activePets.get(e)}},{key:"getAllActivePets",value:function(){return Array.from(this.activePets.values())}},{key:"getActiveCount",value:function(){return this.activePets.size}},{key:"getNextZIndex",value:function(){return F.getNextZIndex()}},{key:"positionMinimizedCard",value:function(e){this.minimizedCards.add(e.id),this.repositionMinimizedCards()}},{key:"repositionMinimizedCards",value:function(){var e,t=this,n=Array.from(this.minimizedCards),a=null===(e=this.floatingButton)||void 0===e?void 0:e.getBoundingClientRect(),i=window.innerWidth-100,o=window.innerHeight-140;a&&(i=a.left-90,o=a.top),n.forEach(function(e,n){var a=t.activePets.get(e);if(a&&a.isMinimized){var s=Math.floor(n/4),r=i-n%4*90,l=o-70*s,c=Math.max(10,Math.min(r,window.innerWidth-90)),d=Math.max(10,Math.min(l,window.innerHeight-70));a.card.style.left=c+"px",a.card.style.top=d+"px"}})}},{key:"isPetActive",value:function(e,t){return Array.from(this.activePets.values()).some(function(n){return n.petData.spellKey===e&&n.petData.petIndex===t})}},{key:"getActivePetsByType",value:function(e,t){return Array.from(this.activePets.values()).filter(function(n){return n.petData.spellKey===e&&n.petData.petIndex===t})}},{key:"minimizeAll",value:function(){this.activePets.forEach(function(e){e.isMinimized||e.minimize()})}},{key:"restoreAll",value:function(){this.activePets.forEach(function(e){e.isMinimized&&e.restore()})}},{key:"closeAll",value:function(){var e=this;Array.from(this.activePets.keys()).forEach(function(t){return e.deactivatePet(t)})}},{key:"extractInstanceNumber",value:function(e){var t=e.match(/#(\d+)$/);return t?parseInt(t[1]):0}},{key:"handleWindowResize",value:function(){this.activePets.forEach(function(e){if(!e.isMinimized&&e.card){var t=e.card.getBoundingClientRect(),n=!1,a=t.left,i=t.top;t.right>window.innerWidth&&(a=window.innerWidth-t.width,n=!0),t.bottom>window.innerHeight&&(i=window.innerHeight-t.height,n=!0),t.left<0&&(a=0,n=!0),t.top<0&&(i=0,n=!0),n&&(e.card.style.left=a+"px",e.card.style.top=i+"px",e.savePosition())}}),this.repositionMinimizedCards()}},{key:"getMinimizedIndex",value:function(e){return Array.from(this.activePets.values()).filter(function(e){return e.petData.isMinimized}).findIndex(function(t){return t.petData.id===e})}},{key:"updateMinimizedPositions",value:function(){Array.from(this.activePets.values()).filter(function(e){return e.petData.isMinimized}).forEach(function(e,t){if(e.minimizedButton){var n=90+70*Math.floor(t/4),a=20+t%4*70;e.minimizedButton.style.bottom="".concat(n,"px"),e.minimizedButton.style.right="".concat(a,"px")}})}},{key:"destroy",value:function(){this.activePets.forEach(function(e){return e.destroy()}),this.activePets.clear(),this.minimizedCards.clear(),this.nextInstanceNumbers.clear(),window.removeEventListener("resize",this.handleWindowResize.bind(this))}}],t&&X(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){Q(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Q(e,t,n){return(t=ne(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function te(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,ne(a.key),a)}}function ne(e){var t=function(e){if("object"!=Z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Z(t)?t:t+""}const ae=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=null,this.currentSpell=null,this.currentLevel=null,this.isMinimized=!1,this.expandedPets=new Set,this.spellDetailsClickHandler=null,this.spellLevelChangeHandler=null,this.activePetsManager=new V,this.dragData={isDragging:!1,startX:0,startY:0,startLeft:0,startTop:0}},t=[{key:"show",value:function(){this.modal||(this.createModal(),this.attachEventListeners(),this.loadSpellList()),this.modal.style.display="flex"}},{key:"hide",value:function(){this.modal&&(this.modal.style.display="none")}},{key:"destroy",value:function(){if(this.modal){var e=this.modal.querySelector(".pets-main-content");e&&this.spellDetailsClickHandler&&e.removeEventListener("click",this.spellDetailsClickHandler);var t=this.modal.querySelector("#spell-level-select");t&&this.spellLevelChangeHandler&&t.removeEventListener("change",this.spellLevelChangeHandler),this.modal.remove(),this.modal=null,this.currentSpell=null,this.currentLevel=null,this.expandedPets.clear(),this.spellDetailsClickHandler=null,this.spellLevelChangeHandler=null}this.activePetsManager&&(this.activePetsManager.destroy(),this.activePetsManager=null)}},{key:"createModal",value:function(){this.modal=document.createElement("div"),this.modal.className="pets-modal",this.modal.innerHTML='\n      <div class="pets-modal-content">\n        <div class="pets-modal-header">\n          <div class="pets-modal-title">\n            <h2>Pet & Summon Manager</h2>\n          </div>\n          <div class="pets-modal-controls">\n            <button class="pets-modal-btn minimize-btn" title="Minimize">\n              <span class="minimize-icon">−</span>\n            </button>\n            <button class="pets-modal-btn maximize-btn" title="Maximize/Restore">\n              <span class="maximize-icon">⬜</span>\n            </button>\n            <button class="pets-modal-btn close-btn" title="Close">\n              <span class="close-icon">×</span>\n            </button>\n          </div>\n        </div>\n        \n        <div class="pets-modal-body">\n          <div class="pets-sidebar">\n            <h3>Available Spells</h3>\n            <div class="spell-list">\n              \x3c!-- Spell list will be populated here --\x3e\n            </div>\n          </div>\n          \n          <div class="pets-main-content">\n            <div class="pets-welcome">\n              <h3>Welcome to Pet Manager</h3>\n              <p>Select a spell from the sidebar to view available pets and summons.</p>\n              <div class="pets-welcome-features">\n                <h4>Features:</h4>\n                <ul>\n                  <li>📋 Complete stat blocks for all pets and summons</li>\n                  <li>📊 Automatic scaling based on spell level</li>\n                  <li>🎯 Optimized for D&D Beyond integration</li>\n                  <li>📱 Draggable and resizable interface</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div class="pets-modal-footer">\n          <div class="pets-modal-status">\n            <span id="pets-status-text">Ready</span>\n          </div>\n        </div>\n      </div>\n    ',document.body.appendChild(this.modal)}},{key:"attachEventListeners",value:function(){var e=this,t=this.modal.querySelector(".pets-modal-header"),n=this.modal.querySelector(".minimize-btn"),a=this.modal.querySelector(".maximize-btn"),i=this.modal.querySelector(".close-btn");t.addEventListener("mousedown",this.startDrag.bind(this)),document.addEventListener("mousemove",this.drag.bind(this)),document.addEventListener("mouseup",this.stopDrag.bind(this)),n.addEventListener("click",this.toggleMinimize.bind(this)),a.addEventListener("click",this.toggleMaximize.bind(this)),i.addEventListener("click",this.hide.bind(this)),[n,a,i].forEach(function(e){e.addEventListener("mousedown",function(e){return e.stopPropagation()})}),this.modal.addEventListener("click",function(t){t.target===e.modal&&e.hide()}),this.modal.querySelector(".pets-modal-content").addEventListener("click",function(e){e.stopPropagation()})}},{key:"startDrag",value:function(e){if(!this.modal.classList.contains("maximized")){this.dragData.isDragging=!0,this.dragData.startX=e.clientX,this.dragData.startY=e.clientY;var t=this.modal.getBoundingClientRect();this.dragData.startLeft=t.left,this.dragData.startTop=t.top,this.modal.style.cursor="grabbing",e.preventDefault()}}},{key:"drag",value:function(e){if(this.dragData.isDragging){var t=e.clientX-this.dragData.startX,n=e.clientY-this.dragData.startY,a=this.dragData.startLeft+t,i=this.dragData.startTop+n,o=this.modal.getBoundingClientRect(),s=window.innerWidth-o.width,r=window.innerHeight-o.height;this.modal.style.left=Math.max(0,Math.min(a,s))+"px",this.modal.style.top=Math.max(0,Math.min(i,r))+"px",this.modal.style.right="auto",this.modal.style.bottom="auto"}}},{key:"stopDrag",value:function(){this.dragData.isDragging=!1,this.modal.style.cursor="default"}},{key:"toggleMinimize",value:function(){var e=this.modal.querySelector(".pets-modal-body"),t=this.modal.querySelector(".pets-modal-footer"),n=this.modal.querySelector(".minimize-icon");this.isMinimized=!this.isMinimized,this.isMinimized?(e.style.display="none",t.style.display="none",n.textContent="+",this.modal.classList.add("minimized")):(e.style.display="flex",t.style.display="block",n.textContent="−",this.modal.classList.remove("minimized"))}},{key:"toggleMaximize",value:function(){var e=this.modal.querySelector(".maximize-icon");this.modal.classList.contains("maximized")?(this.modal.classList.remove("maximized"),e.textContent="⬜"):(this.modal.classList.add("maximized"),e.textContent="⬟")}},{key:"loadSpellList",value:function(){var e=this,t=this.modal.querySelector(".spell-list");t.innerHTML=Object.entries(E).map(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,o,s,r=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=o.call(n)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],a=t[1];return'\n      <div class="spell-item" data-spell="'.concat(n,'">\n        <div class="spell-item-content">\n          <h4>').concat(a.name,'</h4>\n          <p class="spell-description">').concat(a.description,'</p>\n          <div class="spell-meta">\n            <span class="spell-level">Level ').concat(a.summonLevel,'</span>\n            <span class="creature-count">').concat(a.options.length," option").concat(1!==a.options.length?"s":"","</span>\n          </div>\n        </div>\n      </div>\n    ")}).join(""),t.addEventListener("click",function(t){var n=t.target.closest(".spell-item");n&&e.selectSpell(n.dataset.spell)})}},{key:"selectSpell",value:function(e){var t=this;this.modal.querySelectorAll(".spell-item").forEach(function(e){e.classList.remove("selected")});var n=this.modal.querySelector('[data-spell="'.concat(e,'"]'));if(n&&n.classList.add("selected"),this.currentSpell!==e&&this.currentSpell){var a=[];this.expandedPets.forEach(function(e){e.startsWith("".concat(t.currentSpell,"-"))&&a.push(e)}),a.forEach(function(e){return t.expandedPets.delete(e)})}this.currentSpell=e,this.loadSpellDetails(e),this.updateStatus("Loaded ".concat(E[e].name))}},{key:"loadSpellDetails",value:function(e){var t=E[e],n=this.modal.querySelector(".pets-main-content"),a=$($({},t),{},{spellKey:e});n.innerHTML='\n      <div class="spell-details">\n        <div class="spell-header">\n          <h2>'.concat(t.name,'</h2>\n          <p class="spell-description">').concat(t.description,"</p>\n          ").concat(D.renderSpellLevelSelector(t),'\n        </div>\n        \n        <div class="pets-container">\n          ').concat(D.renderPetOptions(a,this.currentLevel,this.activePetsManager),"\n        </div>\n      </div>\n    "),this.attachSpellDetailsEventListeners(),this.restoreExpandedStates()}},{key:"attachSpellDetailsEventListeners",value:function(){var e=this,t=this.modal.querySelector(".pets-main-content");this.spellDetailsClickHandler&&t.removeEventListener("click",this.spellDetailsClickHandler);var n=t.querySelector("#spell-level-select");n&&(this.spellLevelChangeHandler&&n.removeEventListener("change",this.spellLevelChangeHandler),this.spellLevelChangeHandler=function(t){e.updateSpellLevel(parseInt(t.target.value))},n.addEventListener("change",this.spellLevelChangeHandler)),this.spellDetailsClickHandler=function(t){var n=t.target.closest(".activate-pet-btn");if(n){t.stopPropagation();var a=n.dataset.spellKey||e.currentSpell,i=parseInt(n.dataset.petIndex),o=parseInt(n.dataset.spellLevel)||e.currentLevel;e.activatePet(a,i,o)}else{var s=t.target.closest(".pet-option-header");if(s&&!t.target.closest(".activate-pet-btn")){var r=s.closest(".pet-option");r&&e.togglePetDetails(r)}}},t.addEventListener("click",this.spellDetailsClickHandler)}},{key:"updateSpellLevel",value:function(e){this.currentLevel=e;var t=$($({},E[this.currentSpell]),{},{spellKey:this.currentSpell});this.modal.querySelector(".pets-container").innerHTML=D.renderPetOptions(t,e,this.activePetsManager),this.restoreExpandedStates(),this.updateStatus("Updated to spell level ".concat(e))}},{key:"restoreExpandedStates",value:function(){var e=this;this.expandedPets.forEach(function(t){if(t.startsWith("".concat(e.currentSpell,"-"))){var n=t.split("-").pop(),a=e.modal.querySelector('[data-pet-index="'.concat(n,'"]'));if(a){var i=a.querySelector(".pet-option-content");i&&(a.classList.add("expanded"),i.style.display="block")}}})}},{key:"togglePetDetails",value:function(e){var t=e.querySelector(".pet-option-content"),n=e.classList.contains("expanded"),a=e.dataset.petIndex,i="".concat(this.currentSpell,"-").concat(a);a?n?(e.classList.remove("expanded"),t.style.display="none",this.expandedPets.delete(i)):(e.classList.add("expanded"),t.style.display="block",this.expandedPets.add(i)):console.warn("Pet option missing data-pet-index attribute")}},{key:"updateStatus",value:function(e){var t=this.modal.querySelector("#pets-status-text");t&&(t.textContent=e,setTimeout(function(){t.textContent===e&&(t.textContent="Ready")},3e3))}},{key:"activatePet",value:function(e,t,n){var a=E[e];if((null==a?void 0:a.options[t])&&a)try{var i=this.activePetsManager.activatePet(e,t,n);i?(this.updateStatus("Activated ".concat(i.petData.instanceName)),this.refreshCurrentView()):this.updateStatus("Failed to activate pet")}catch(e){console.error("Error activating pet:",e),this.updateStatus("Error activating pet")}else this.updateStatus("Error: Pet not found")}},{key:"refreshCurrentView",value:function(){if(this.currentSpell){var e=$($({},E[this.currentSpell]),{},{spellKey:this.currentSpell}),t=this.modal.querySelector(".pets-container");t&&(t.innerHTML=D.renderPetOptions(e,this.currentLevel,this.activePetsManager),this.restoreExpandedStates())}}},{key:"isVisible",value:function(){return this.modal&&"none"!==this.modal.style.display}},{key:"toggleVisibility",value:function(){this.isVisible()?this.hide():this.show()}}],t&&te(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function oe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,se(a.key),a)}}function se(e){var t=function(e){if("object"!=ie(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ie(t)?t:t+""}const re=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="Pets",this.description="Manage pet and summon stat blocks with scaling and UI controls",this.initialized=!1,this.modal=null,this.toolbeltButton=null},(t=[{key:"init",value:function(){this.initialized||(console.log("🐾 Pets feature initializing..."),this.injectStyles(),this.createModal(),this.addToolbeltButton(),this.initialized=!0,console.log("🐾 Pets feature initialized"))}},{key:"disable",value:function(){this.initialized&&(this.removeToolbeltButton(),this.destroyModal(),this.removeStyles(),this.initialized=!1,console.log("🐾 Pets feature disabled"))}},{key:"onTabChange",value:function(e){this.initialized&&console.log("Pets feature: Tab changed to",e)}},{key:"injectStyles",value:function(){if(!document.getElementById("pets-feature-styles")){var e=document.createElement("style");e.id="pets-feature-styles",e.textContent="\n      /* Pets Modal Styles */\n      .pets-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.6);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 10000;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n\n      .pets-modal-content {\n        background: #1e1e1e;\n        border: 1px solid #444;\n        border-radius: 8px;\n        width: 90vw;\n        max-width: 1200px;\n        height: 80vh;\n        max-height: 800px;\n        display: flex;\n        flex-direction: column;\n        color: #e0e0e0;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n        overflow: hidden;\n      }\n\n      .pets-modal.minimized .pets-modal-content {\n        height: auto;\n        max-height: none;\n      }\n\n      .pets-modal.maximized {\n        align-items: stretch;\n        justify-content: stretch;\n      }\n\n      .pets-modal.maximized .pets-modal-content {\n        width: 100vw;\n        height: 100vh;\n        max-width: none;\n        max-height: none;\n        border-radius: 0;\n      }\n\n      /* Modal Header */\n      .pets-modal-header {\n        background: #2d2d2d;\n        border-bottom: 1px solid #444;\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        cursor: grab;\n        user-select: none;\n      }\n\n      .pets-modal-header:active {\n        cursor: grabbing;\n      }\n\n      .pets-modal-title h2 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #e0e0e0;\n      }\n\n      .pets-modal-controls {\n        display: flex;\n        gap: 8px;\n      }\n\n      .pets-modal-btn {\n        background: #444;\n        border: 1px solid #666;\n        border-radius: 4px;\n        width: 28px;\n        height: 28px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        color: #e0e0e0;\n        font-size: 14px;\n        transition: all 0.2s ease;\n      }\n\n      .pets-modal-btn:hover {\n        background: #555;\n        border-color: #777;\n      }\n\n      .pets-modal-btn:active {\n        background: #333;\n        transform: scale(0.95);\n      }\n\n      .close-btn:hover {\n        background: #cc4125;\n        border-color: #cc4125;\n      }\n\n      /* Modal Body */\n      .pets-modal-body {\n        flex: 1;\n        display: flex;\n        overflow: hidden;\n      }\n\n      .pets-sidebar {\n        width: 300px;\n        background: #2a2a2a;\n        border-right: 1px solid #444;\n        padding: 16px;\n        overflow-y: auto;\n      }\n\n      .pets-sidebar h3 {\n        margin: 0 0 16px 0;\n        font-size: 16px;\n        color: #e0e0e0;\n        border-bottom: 1px solid #444;\n        padding-bottom: 8px;\n      }\n\n      .spell-list {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n\n      .spell-item {\n        background: #1e1e1e;\n        border: 1px solid #444;\n        border-radius: 6px;\n        padding: 12px;\n        cursor: pointer;\n        transition: all 0.2s ease;\n      }\n\n      .spell-item:hover {\n        background: #333;\n        border-color: #666;\n      }\n\n      .spell-item.selected {\n        background: #0d7377;\n        border-color: #14a085;\n      }\n\n      .spell-item h4 {\n        margin: 0 0 6px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #e0e0e0;\n      }\n\n      .spell-description {\n        margin: 0 0 8px 0;\n        font-size: 12px;\n        color: #b0b0b0;\n        line-height: 1.4;\n      }\n\n      .spell-meta {\n        display: flex;\n        justify-content: space-between;\n        font-size: 11px;\n        color: #888;\n      }\n\n      .spell-level {\n        background: #444;\n        padding: 2px 6px;\n        border-radius: 3px;\n      }\n\n      /* Main Content */\n      .pets-main-content {\n        flex: 1;\n        padding: 16px;\n        overflow-y: auto;\n        background: #1a1a1a;\n      }\n\n      .pets-welcome {\n        text-align: center;\n        padding: 40px 20px;\n        color: #b0b0b0;\n      }\n\n      .pets-welcome h3 {\n        margin: 0 0 16px 0;\n        color: #e0e0e0;\n      }\n\n      /* Pet Options */\n      .pet-options {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .pet-option {\n        background: #2a2a2a;\n        border: 1px solid #444;\n        border-radius: 6px;\n        overflow: hidden;\n        transition: all 0.2s ease;\n      }\n\n      .pet-option:hover {\n        border-color: #666;\n      }\n\n      .pet-option.expanded {\n        border-color: #0d7377;\n      }\n\n      .pet-option-header {\n        padding: 12px 16px;\n        background: #333;\n        cursor: pointer;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        user-select: none;\n      }\n\n      .pet-option-header h4 {\n        margin: 0;\n        color: #e0e0e0;\n        font-size: 16px;\n      }\n\n      .pet-option-content {\n        display: none;\n        padding: 16px;\n        background: #1e1e1e;\n      }\n\n      /* Pet Stat Blocks */\n      .pet-stat-block {\n        font-family: 'Georgia', serif;\n        line-height: 1.5;\n      }\n\n      .pet-header {\n        margin-bottom: 12px;\n        border-bottom: 2px solid #8B0000;\n        padding-bottom: 8px;\n      }\n\n      .pet-name {\n        margin: 0 0 4px 0;\n        font-size: 20px;\n        font-weight: bold;\n        color: #e0e0e0;\n      }\n\n      .pet-type {\n        font-style: italic;\n        color: #b0b0b0;\n        font-size: 14px;\n      }\n\n      .stat-line {\n        margin-bottom: 4px;\n        font-size: 14px;\n      }\n\n      .stat-line strong {\n        color: #e0e0e0;\n      }\n\n      /* Ability Scores */\n      .ability-scores {\n        display: grid;\n        grid-template-columns: repeat(6, 1fr);\n        gap: 8px;\n        margin: 12px 0;\n        padding: 12px;\n        background: #333;\n        border-radius: 4px;\n      }\n\n      .ability-score {\n        text-align: center;\n      }\n\n      .ability-name {\n        font-size: 12px;\n        font-weight: bold;\n        color: #b0b0b0;\n        margin-bottom: 4px;\n      }\n\n      .ability-value {\n        font-size: 14px;\n        color: #e0e0e0;\n      }\n\n      /* Pet Abilities and Actions */\n      .pet-abilities,\n      .pet-actions {\n        margin-top: 12px;\n      }\n\n      .pet-abilities h4,\n      .pet-actions h4 {\n        margin: 0 0 8px 0;\n        color: #e0e0e0;\n        font-size: 16px;\n        border-bottom: 1px solid #8B0000;\n        padding-bottom: 4px;\n      }\n\n      .ability,\n      .action {\n        margin-bottom: 8px;\n        font-size: 14px;\n        color: #d0d0d0;\n      }\n\n      .ability strong,\n      .action strong {\n        color: #e0e0e0;\n      }\n\n      /* Modal Footer */\n      .pets-modal-footer {\n        background: #2d2d2d;\n        border-top: 1px solid #444;\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .pets-modal-status {\n        font-size: 12px;\n        color: #b0b0b0;\n      }\n\n      /* Toolbelt Floating Button */\n      .pets-floating-btn {\n        font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif !important;\n      }\n      \n      .pets-floating-btn:hover {\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4) !important;\n      }\n      \n      .pets-floating-btn:active {\n        transform: scale(0.95) !important;\n      }\n\n      /* Responsive Design */\n      @media (max-width: 768px) {\n        .pets-modal-content {\n          width: 95vw;\n          height: 90vh;\n        }\n        \n        .pets-modal-body {\n          flex-direction: column;\n        }\n        \n        .pets-sidebar {\n          width: 100%;\n          max-height: 200px;\n          border-right: none;\n          border-bottom: 1px solid #444;\n        }\n        \n        .ability-scores {\n          grid-template-columns: repeat(3, 1fr);\n        }\n      }\n\n      /* Pet Header Controls */\n      .pet-option-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 8px 0;\n      }\n\n      .pet-header-main {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        flex: 1;\n      }\n\n      .pet-header-controls {\n        display: flex;\n        gap: 8px;\n      }\n\n      /* Active Pet Cards Styles */\n      .active-pet-card {\n        position: fixed;\n        background: linear-gradient(135deg, #f9f5f0 0%, #f4ede4 100%);\n        border: 2px solid #8b4513;\n        border-radius: 8px;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n        font-family: 'Roboto Condensed', Arial, sans-serif;\n        user-select: none;\n        overflow: hidden;\n        backdrop-filter: blur(10px);\n        min-width: 250px;\n        min-height: 300px;\n        max-width: 600px;\n        max-height: 800px;\n        z-index: 1000;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .active-pet-card.minimized {\n        width: 80px !important;\n        height: 60px !important;\n        min-width: 80px;\n        min-height: 60px;\n        border-radius: 12px;\n        cursor: pointer;\n        transition: transform 0.2s ease;\n      }\n\n      .active-pet-card.minimized:hover {\n        transform: scale(1.05);\n      }\n\n      /* Active Pet Header */\n      .active-pet-header {\n        background: linear-gradient(135deg, #c41e3a 0%, #8b2635 100%);\n        color: white;\n        padding: 8px 12px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        cursor: grab;\n        border-bottom: 2px solid #8b4513;\n        flex-shrink: 0;\n      }\n\n      .active-pet-header:active {\n        cursor: grabbing;\n      }\n\n      .active-pet-title h3 {\n        margin: 0;\n        font-size: 16px;\n        font-weight: bold;\n        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);\n      }\n\n      .active-pet-title .pet-type {\n        font-size: 12px;\n        opacity: 0.9;\n        font-style: italic;\n      }\n\n      .active-pet-controls {\n        display: flex;\n        gap: 4px;\n      }\n\n      .active-pet-btn {\n        background: rgba(255, 255, 255, 0.2);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n        color: white;\n        width: 24px;\n        height: 24px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 14px;\n        font-weight: bold;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 0.2s ease;\n      }\n\n      .active-pet-btn:hover {\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      /* HP Section */\n      .active-pet-hp-section {\n        padding: 12px;\n        border-bottom: 1px solid #d2b48c;\n        background: rgba(255, 255, 255, 0.5);\n        flex-shrink: 0;\n      }\n\n      .hp-display {\n        display: flex;\n        align-items: center;\n        margin-bottom: 8px;\n      }\n\n      .hp-current {\n        display: flex;\n        align-items: center;\n        gap: 4px;\n        font-size: 18px;\n        font-weight: bold;\n      }\n\n      .hp-input {\n        width: 50px;\n        padding: 4px;\n        border: 1px solid #8b4513;\n        border-radius: 4px;\n        text-align: center;\n        font-size: 16px;\n        font-weight: bold;\n        background: white;\n      }\n\n      .hp-separator {\n        color: #8b4513;\n        font-size: 20px;\n      }\n\n      .hp-max {\n        color: #2e7d32;\n        font-size: 18px;\n      }\n\n      .hp-temp {\n        color: #1976d2;\n        font-size: 14px;\n        background: rgba(25, 118, 210, 0.1);\n        padding: 2px 6px;\n        border-radius: 4px;\n        border: 1px solid #1976d2;\n      }\n\n      .hp-bar {\n        width: 100%;\n        height: 8px;\n        background: #e0e0e0;\n        border-radius: 4px;\n        overflow: hidden;\n        margin-bottom: 12px;\n        border: 1px solid #8b4513;\n      }\n\n      .hp-bar-fill {\n        height: 100%;\n        transition: width 0.3s ease, background-color 0.3s ease;\n      }\n\n      .hp-controls {\n        display: grid;\n        grid-template-columns: 1fr 1fr 1fr;\n        gap: 8px;\n        margin-bottom: 8px;\n      }\n\n      .hp-control-group {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n      }\n\n      .hp-control-group label {\n        font-size: 12px;\n        font-weight: bold;\n        color: #8b4513;\n      }\n\n      .hp-control-group input {\n        padding: 4px;\n        border: 1px solid #8b4513;\n        border-radius: 4px;\n        font-size: 12px;\n      }\n\n      .hp-control-group button {\n        padding: 4px 8px;\n        background: #c41e3a;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        font-size: 12px;\n        cursor: pointer;\n        font-weight: bold;\n        transition: background-color 0.2s ease;\n      }\n\n      .hp-control-group button:hover {\n        background: #8b2635;\n      }\n\n      .hp-quick-buttons {\n        display: flex;\n        gap: 4px;\n        justify-content: center;\n      }\n\n      .quick-hp-btn {\n        padding: 4px 8px;\n        background: #8b4513;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        font-size: 12px;\n        font-weight: bold;\n        cursor: pointer;\n        min-width: 32px;\n        transition: background-color 0.2s ease;\n      }\n\n      .quick-hp-btn:hover {\n        background: #a0522d;\n      }\n\n      /* Stats Section */\n      .active-pet-stats {\n        padding: 12px;\n        overflow-y: auto;\n        flex: 1;\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      /* Override pet stat block styles for active cards */\n      .active-pet-card .pet-stat-block {\n        background: transparent;\n        border: none;\n        box-shadow: none;\n        margin: 0;\n      }\n\n      .active-pet-card .pet-header h3 {\n        color: #8b4513;\n        font-size: 16px;\n        margin-bottom: 4px;\n      }\n\n      .active-pet-card .pet-type {\n        color: #666;\n        font-size: 12px;\n        font-style: italic;\n      }\n\n      .active-pet-card .ability-scores {\n        display: grid;\n        grid-template-columns: repeat(3, 1fr);\n        gap: 8px;\n        margin: 12px 0;\n      }\n\n      .active-pet-card .ability-score {\n        text-align: center;\n        background: rgba(255, 255, 255, 0.7);\n        border: 1px solid #8b4513;\n        border-radius: 4px;\n        padding: 6px 4px;\n      }\n\n      .active-pet-card .ability-name {\n        font-size: 10px;\n        font-weight: bold;\n        color: #8b4513;\n        margin-bottom: 2px;\n      }\n\n      .active-pet-card .ability-value {\n        font-size: 12px;\n        font-weight: bold;\n        color: #333;\n      }\n\n      .active-pet-card .stat-line {\n        font-size: 12px;\n        margin: 4px 0;\n        line-height: 1.3;\n      }\n\n      .active-pet-card .stat-line strong {\n        color: #8b4513;\n      }\n\n      /* Resize Handles */\n      .resize-handle {\n        position: absolute;\n        background: transparent;\n        z-index: 10;\n      }\n\n      .resize-n, .resize-s {\n        width: 100%;\n        height: 8px;\n        cursor: ns-resize;\n      }\n\n      .resize-e, .resize-w {\n        width: 8px;\n        height: 100%;\n        cursor: ew-resize;\n      }\n\n      .resize-n { top: -4px; left: 0; }\n      .resize-s { bottom: -4px; left: 0; }\n      .resize-e { top: 0; right: -4px; }\n      .resize-w { top: 0; left: -4px; }\n\n      .resize-ne, .resize-nw, .resize-se, .resize-sw {\n        width: 12px;\n        height: 12px;\n      }\n\n      .resize-ne { top: -6px; right: -6px; cursor: nesw-resize; }\n      .resize-nw { top: -6px; left: -6px; cursor: nwse-resize; }\n      .resize-se { bottom: -6px; right: -6px; cursor: nwse-resize; }\n      .resize-sw { bottom: -6px; left: -6px; cursor: nesw-resize; }\n\n      /* Minimized Card Styles */\n      .minimized-pet-content {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        padding: 4px;\n        position: relative;\n      }\n\n      .minimized-pet-name {\n        font-size: 10px;\n        font-weight: bold;\n        color: #8b4513;\n        text-align: center;\n        line-height: 1;\n        margin-bottom: 2px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        max-width: 70px;\n      }\n\n      .minimized-hp-bar {\n        width: 60px;\n        height: 4px;\n        background: #e0e0e0;\n        border-radius: 2px;\n        overflow: hidden;\n        margin: 2px 0;\n        border: 1px solid #8b4513;\n      }\n\n      .minimized-hp-fill {\n        height: 100%;\n        transition: width 0.3s ease;\n        background: #4CAF50;\n      }\n\n      .minimized-hp-text {\n        font-size: 8px;\n        color: #666;\n        line-height: 1;\n      }\n\n      .minimized-close-btn {\n        position: absolute;\n        top: -2px;\n        right: -2px;\n        width: 16px;\n        height: 16px;\n        background: #c41e3a;\n        color: white;\n        border: none;\n        border-radius: 50%;\n        font-size: 10px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n\n      .active-pet-card.minimized:hover .minimized-close-btn {\n        opacity: 1;\n      }\n\n      /* Minimized pet floating button */\n      .active-pet-minimized {\n        position: fixed;\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);\n        border: 3px solid #fff;\n        color: white;\n        cursor: pointer;\n        z-index: 10000;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n        transition: all 0.3s ease;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .active-pet-minimized:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);\n      }\n\n      .active-pet-minimized:hover .minimized-pet-tooltip {\n        display: block;\n      }\n\n      .minimized-pet-icon {\n        font-size: 24px;\n      }\n\n      .minimized-pet-tooltip {\n        display: none;\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        background-color: rgba(0, 0, 0, 0.9);\n        color: white;\n        padding: 8px 12px;\n        border-radius: 6px;\n        white-space: nowrap;\n        font-size: 12px;\n        pointer-events: none;\n        z-index: 10001;\n      }\n\n      .tooltip-name {\n        font-weight: bold;\n        margin-bottom: 4px;\n      }\n\n      .tooltip-hp {\n        color: #4fc3f7;\n      }\n\n      /* Resize handles */\n      .resize-handle {\n        position: absolute;\n        background-color: transparent;\n        z-index: 10;\n      }\n\n      .resize-handle:hover {\n        background-color: rgba(79, 195, 247, 0.3);\n      }\n\n      .resize-n, .resize-s {\n        left: 10%;\n        right: 10%;\n        height: 10px;\n        cursor: ns-resize;\n      }\n\n      .resize-n { top: -5px; }\n      .resize-s { bottom: -5px; }\n\n      .resize-e, .resize-w {\n        top: 10%;\n        bottom: 10%;\n        width: 10px;\n        cursor: ew-resize;\n      }\n\n      .resize-e { right: -5px; }\n      .resize-w { left: -5px; }\n\n      .resize-ne, .resize-se, .resize-sw, .resize-nw {\n        width: 20px;\n        height: 20px;\n      }\n\n      .resize-ne {\n        top: -10px;\n        right: -10px;\n        cursor: nesw-resize;\n      }\n\n      .resize-se {\n        bottom: -10px;\n        right: -10px;\n        cursor: nwse-resize;\n      }\n\n      .resize-sw {\n        bottom: -10px;\n        left: -10px;\n        cursor: nesw-resize;\n      }\n\n      .resize-nw {\n        top: -10px;\n        left: -10px;\n        cursor: nwse-resize;\n      }\n\n      .active-pet-card.resizing {\n        opacity: 0.8;\n        user-select: none;\n      }\n\n      /* Add button styles for activating pets */\n      .activate-pet-btn {\n        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);\n        color: white;\n        border: none;\n        padding: 6px 12px;\n        border-radius: 4px;\n        font-size: 12px;\n        font-weight: bold;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n      }\n\n      .activate-pet-btn:hover {\n        background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);\n        transform: translateY(-1px);\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n      }\n\n      .activate-pet-btn:active {\n        transform: translateY(0);\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n      }\n\n      /* Pet option active indicator */\n      .pet-option.has-active-pets {\n        border-left: 4px solid #4CAF50;\n      }\n\n      .pet-option.has-active-pets .pet-option-header {\n        background: linear-gradient(to right, rgba(76, 175, 80, 0.1), transparent);\n      }\n\n      .active-pets-indicator {\n        display: inline-block;\n        background: #4CAF50;\n        color: white;\n        padding: 2px 6px;\n        border-radius: 10px;\n        font-size: 10px;\n        font-weight: bold;\n      }\n    ",document.head.appendChild(e),console.log("🐾 Pets feature styles injected")}}},{key:"removeStyles",value:function(){var e=document.getElementById("pets-feature-styles");e&&e.remove()}},{key:"createModal",value:function(){this.modal||(this.modal=new ae)}},{key:"destroyModal",value:function(){this.modal&&(this.modal.destroy(),this.modal=null)}},{key:"addToolbeltButton",value:function(){this.toolbeltButton||this.createFloatingButton()}},{key:"createFloatingButton",value:function(){var e=this;this.toolbeltButton=document.createElement("button"),this.toolbeltButton.className="pets-floating-btn",this.toolbeltButton.innerHTML="🐾",this.toolbeltButton.title="Open Pet & Summon Manager",Object.assign(this.toolbeltButton.style,{position:"fixed",bottom:"20px",right:"20px",width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#2a2a2a",border:"2px solid #444",color:"#e0e0e0",fontSize:"24px",cursor:"pointer",zIndex:"9999",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"}),this.toolbeltButton.addEventListener("mouseenter",function(){e.toolbeltButton.style.backgroundColor="#333",e.toolbeltButton.style.borderColor="#666",e.toolbeltButton.style.transform="scale(1.1)"}),this.toolbeltButton.addEventListener("mouseleave",function(){e.toolbeltButton.style.backgroundColor="#2a2a2a",e.toolbeltButton.style.borderColor="#444",e.toolbeltButton.style.transform="scale(1)"}),this.toolbeltButton.addEventListener("click",function(){e.modal&&e.modal.toggleVisibility()}),document.body.appendChild(this.toolbeltButton)}},{key:"removeToolbeltButton",value:function(){this.toolbeltButton&&(this.toolbeltButton.remove(),this.toolbeltButton=null)}},{key:"showModal",value:function(){this.modal&&this.modal.show()}},{key:"hideModal",value:function(){this.modal&&this.modal.hide()}},{key:"toggleModal",value:function(){this.modal&&this.modal.toggleVisibility()}},{key:"isModalVisible",value:function(){return!!this.modal&&this.modal.isVisible()}},{key:"getPetData",value:function(e){try{return null}catch(e){return console.error("Failed to load pet data:",e),null}}},{key:"getSupportedSpells",value:function(){return["find-familiar","summon-draconic-spirit","animate-objects","conjure-animals","bigbys-hand","spiritual-weapon"]}}])&&oe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function de(e,t,n){return(t=ue(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,ue(a.key),a)}}function ue(e){var t=function(e){if("object"!=le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==le(t)?t:t+""}const me=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tabDetector=t,this.features={spellEnhancements:new f,addExtraSpells:new S,pets:new re},this.enabledFeatures=new Set,this.storageKey="dndbeyond-toolbelt-enabled-features",this.loadEnabledFeatures(),this.tabDetector&&this.tabDetector.addTabChangeListener(function(e,t){n.enabledFeatures.forEach(function(a){var i=n.features[a];i&&i.onTabChange&&i.onTabChange(e,t)})})},t=[{key:"enableFeature",value:function(e){var t=this.features[e];if(t&&!this.enabledFeatures.has(e))try{t.initialized||t.init(),this.enabledFeatures.add(e),this.saveEnabledFeatures()}catch(t){console.error("❌ Failed to enable feature ".concat(e,":"),t)}}},{key:"disableFeature",value:function(e){var t=this.features[e];if(t&&this.enabledFeatures.has(e))try{"function"==typeof t.disable&&t.disable(),this.enabledFeatures.delete(e),this.saveEnabledFeatures()}catch(t){console.error("❌ Failed to disable feature ".concat(e,":"),t)}}},{key:"isFeatureEnabled",value:function(e){return this.enabledFeatures.has(e)}},{key:"getAllEnabledFeatures",value:function(){return Array.from(this.enabledFeatures)}},{key:"getAllFeatures",value:function(){return Object.keys(this.features)}},{key:"getFeatureInfo",value:function(e){var t=this.features[e];return t?{name:t.name,description:t.description,enabled:this.isFeatureEnabled(e),initialized:t.initialized}:null}},{key:"getAllFeaturesInfo",value:function(){var e=this;return Object.keys(this.features).map(function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach(function(t){de(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({key:t},e.getFeatureInfo(t))})}},{key:"disableAllFeatures",value:function(){var e=this;this.enabledFeatures.forEach(function(t){e.disableFeature(t)})}},{key:"saveEnabledFeatures",value:function(){if(!this.isLoading)try{var e=Array.from(this.enabledFeatures);localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.error("❌ Failed to save enabled features to local storage:",e)}}},{key:"loadEnabledFeatures",value:function(){var e=this;try{var t=localStorage.getItem(this.storageKey);if(t){var n=JSON.parse(t);this.enabledFeatures.clear(),n.length>0&&(this.isLoading=!0,n.forEach(function(t){e.features[t]&&e.enableFeature(t)}),this.isLoading=!1)}else this.enabledFeatures.clear(),this.saveEnabledFeatures()}catch(e){console.error("❌ Failed to load enabled features from local storage:",e),localStorage.removeItem(this.storageKey),this.enabledFeatures.clear()}}},{key:"clearStoredPreferences",value:function(){try{localStorage.removeItem(this.storageKey)}catch(e){console.error("❌ Failed to clear stored preferences:",e)}}}],t&&pe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function fe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,ge(a.key),a)}}function ge(e){var t=function(e){if("object"!=he(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=he(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==he(t)?t:t+""}const ve=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentTab=null,this.observers=[],this.tabChangeListeners=[],this.isWatching=!1},(t=[{key:"init",value:function(){this.isWatching||(console.log("👁️ Tab detector initialized"),this.startWatching(),this.isWatching=!0)}},{key:"startWatching",value:function(){var e=this;this.detectCurrentTab();var t=new MutationObserver(function(){e.detectCurrentTab()}),n=document.querySelector('menu[class*="styles_tabs_"]');n&&t.observe(n,{attributes:!0,subtree:!0,attributeFilter:["aria-checked"]});var a=new MutationObserver(function(){var n=document.querySelector('menu[class*="styles_tabs_"]');n&&!e.observers.includes(n)&&t.observe(n,{attributes:!0,subtree:!0,attributeFilter:["aria-checked"]})});a.observe(document.body,{childList:!0,subtree:!0}),this.observers.push(t,a)}},{key:"detectCurrentTab",value:function(){var e=this,t=document.querySelector('menu[class*="styles_tabs_"]');if(t){var n=t.querySelectorAll("li button"),a=null;n.forEach(function(t){var n="true"===t.getAttribute("aria-checked"),i=t.textContent.trim();n&&(a=i),(e.currentTab!==i||n)&&e.notifyTabChange(i,n)}),this.currentTab!==a&&(console.log("🔄 Tab changed: ".concat(this.currentTab," → ").concat(a)),this.currentTab=a)}else null!==this.currentTab&&(this.currentTab=null,this.notifyTabChange(null,!1))}},{key:"addTabChangeListener",value:function(e){this.tabChangeListeners.push(e)}},{key:"removeTabChangeListener",value:function(e){var t=this.tabChangeListeners.indexOf(e);t>-1&&this.tabChangeListeners.splice(t,1)}},{key:"notifyTabChange",value:function(e,t){this.tabChangeListeners.forEach(function(n){try{n(e,t)}catch(e){console.error("Error in tab change listener:",e)}})}},{key:"getCurrentTab",value:function(){return this.currentTab}},{key:"destroy",value:function(){this.observers.forEach(function(e){return e.disconnect()}),this.observers=[],this.tabChangeListeners=[],this.isWatching=!1,console.log("👁️ Tab detector destroyed")}}])&&fe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function be(e){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be(e)}function ye(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,xe(a.key),a)}}function xe(e){var t=function(e){if("object"!=be(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=be(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==be(t)?t:t+""}const ke=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.isControlPanelOpen=!1,this.tabDetector=new ve,this.featureManager=new me(this.tabDetector),this.globalToggleEnabled=!0,this.button=null,this.controlPanel=null,this.toggleControlPanel=this.toggleControlPanel.bind(this),this.toggleFeature=this.toggleFeature.bind(this),this.closeControlPanel=this.closeControlPanel.bind(this)},(t=[{key:"mount",value:function(){this.button=new s(this.toggleControlPanel);var e=this.button.render();this.container.appendChild(e),this.tabDetector.init()}},{key:"toggleControlPanel",value:function(){this.isControlPanelOpen=!this.isControlPanelOpen,this.isControlPanelOpen?this.showControlPanel():this.hideControlPanel()}},{key:"showControlPanel",value:function(){this.controlPanel||(this.controlPanel=new p(this.getFeaturesForUI(),this.toggleFeature,this.closeControlPanel)),document.body.appendChild(this.controlPanel.render())}},{key:"hideControlPanel",value:function(){this.controlPanel&&this.controlPanel.element&&document.body.removeChild(this.controlPanel.element)}},{key:"closeControlPanel",value:function(){this.isControlPanelOpen=!1,this.hideControlPanel()}},{key:"getFeaturesForUI",value:function(){var e=this.featureManager.getAllFeaturesInfo(),t={};return e.forEach(function(e){t[e.key]={label:e.name,description:e.description,enabled:e.enabled}}),t.globalToggle={label:"Enable All Features",description:"Master toggle for all toolbelt features",enabled:this.globalToggleEnabled},t}},{key:"toggleFeature",value:function(e){var t=this;if("globalToggle"===e)this.globalToggleEnabled=!this.globalToggleEnabled,this.featureManager.getAllFeatures().forEach(function(e){t.globalToggleEnabled?t.featureManager.enableFeature(e):t.featureManager.disableFeature(e)});else{this.featureManager.isFeatureEnabled(e)?this.featureManager.disableFeature(e):this.featureManager.enableFeature(e);var n=this.featureManager.getAllFeatures().every(function(e){return t.featureManager.isFeatureEnabled(e)});this.globalToggleEnabled=n}this.controlPanel&&this.controlPanel.updateFeatures(this.getFeaturesForUI())}}])&&ye(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();var we=n(72),Se=n.n(we),ze=n(825),Pe=n.n(ze),Ce=n(659),Me=n.n(Ce),De=n(56),Ae=n.n(De),Ee=n(540),Le=n.n(Ee),Te=n(113),je=n.n(Te),_e=n(365),Oe={};function He(){var e=document.querySelector(".ct-character-header-desktop");if(!e)return console.log("D&D Beyond character header not found, retrying...!"),void setTimeout(He,1e3);console.log("D&D Beyond Toolbelt initializing.");var t=e.querySelector(".ct-character-header-desktop__group--share");if(!t)return console.log("Share button group not found, retrying..."),void setTimeout(He,1e3);if(document.getElementById("dndbeyond-toolbelt-root"))console.log("D&D Beyond Toolbelt already initialized...!");else{var n=document.createElement("div");n.id="dndbeyond-toolbelt-root",n.className="ct-character-header-desktop__group ct-character-header-desktop__group--toolbelt",t.parentNode.insertBefore(n,t),new ke(n).mount(),console.log("D&D Beyond Toolbelt initialized successfully!")}}Oe.styleTagTransform=je(),Oe.setAttributes=Ae(),Oe.insert=Me().bind(null,"head"),Oe.domAPI=Pe(),Oe.insertStyleElement=Le(),Se()(_e.A,Oe),_e.A&&_e.A.locals&&_e.A.locals,(window.location.hostname.includes("dndbeyond.com")||window.location.hostname.includes("localhost"))&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",He):He()),window.DNDBeyondToolbelt={init:He},DNDBeyondToolbelt={}})();